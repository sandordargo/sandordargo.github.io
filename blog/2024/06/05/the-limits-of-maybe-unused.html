<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="The limits of [[maybe_unused]]" /><meta property="og:locale" content="en_US" /><meta name="description" content="The codebase I work with defines a utility macro called UNUSED. Its implementation is straightforward, it takes a variable (let’s call it x) as a parameter and expands it as ((void)x). The reason we use it is to avoid compiler warnings for unused variables. Why don’t we delete those variables you might ask? We usually end up with the need for UNUSED when we use preprocessor macros to include certain pieces of code only in debug builds, for example, debug logs. This is a simple enough example, right? 1 2 3 4 5 auto result = doSomething(param); #ifdef DEBUG std::cout &lt;&lt; &quot;Result: &quot; &lt;&lt; result &lt;&lt; &#39;\n&#39;; #endif UNUSED(result); In this case, if we compile in release mode, result is only used by UNUSED. If we haven’t had that, the compilation would fail in release mode. But we don’t like macros, do we? They are error-prone due to their limited readability and complicated debugging. Can we do something better? First of all, even though I agree with Arne and I dislike macros, I think that the macro is still more readable in this case than what it hides: (void)x; But since C++17 we also have the [[maybe_unused]] attribute at our hands. If an entity is declared with this label, any lack of usage emitted warning will be suppressed. Can it replace our UNUSED macro? The answer is sadly no. It’s true that [[maybe_unused]] can be used in a lot of places. Starting from C++26 it can even mark attributes as potentially unused ones. Until then, we have the following possibilities. Any class / struct or union can be declared as such: class [[maybe_unused]] Wrapper. Though I’ve barely seen a compiler complaining that a class is unused… typedefs or alias declarations using the using keyword can also be declared with [[maybe_unused]]. 1 2 using Squad [[maybe_unused]] = std::vector&lt;Player&gt;; [[maybe_unused]] typedef std::vector&lt;Player&gt; Squad; Local and non-static data members can also be [[maybe_unused]], just like functions, enumerators and enumerations. [[maybe_unused]] can even be used with structured bindings. 1 2 3 4 5 6 7 8 9 10 enum [[maybe_unused]] E { A [[maybe_unused]], B [[maybe_unused]] = 42 }; [[maybe_unused]] void foo([[maybe_unused]] int param) { [[maybe_unused]] bar = 3 * param; assert(bar); // only compiled in debug mode } Though, with structured bindings, we are reaching the limits of [[maybe_unused]]. If you use [[maybe_unused]], then all the subobjects are declared as maybe unused. You cannot simply mark specific subobjects. It’s one or nothing. 1 2 3 // both &#39;a&#39; and &#39;b&#39; might be unused // you cannot have only one of them [[maybe_unused]] [[maybe_unused]] auto [a, b] = std::make_pair(42, 0.23); So why did I say that it cannot replace the UNUSED macro? Well, there is one thing it cannot mark maybe unused. Lambda captures. If you have a lambda capture that will be only part of the debug build, the release build will complain. And you have no way to use [[maybe_unused]] with a lambda capture. When this question came up at a mailing list, the answer of a committee member was that you should use (void)x;, as it means less clutter and it’s easier to read and maintain. Quite ironic as this solution can be always used, yet [[maybe_unused]] seems superior in terms of readability. 1 2 3 4 5 6 7 auto foo = doSomething(param); auto callback = [&amp;foo] () { #ifdef DEBUG std::cout &lt;&lt; &quot;foo: &quot; &lt;&lt; foo &lt;&lt; &#39;\n&#39;; #endif UNUSED(result); // or (void)result; }; Too bad. What can we do? We can keep using our good old UNUSED macro. Conclusion In this article, we’ve seen that the [[maybe_unused]] label can help us suppress compiler warnings for variables (and other entities) that are only used in certain builds. Sadly, it doesn’t work in all situations, you cannot use it with lambda captures. In those situations, we still need other solutions, such as plain cast to void or a macro. Connect deeper If you liked this article, please hit on the like button, subscribe to my newsletter and let’s connect on Twitter!" /><meta property="og:description" content="The codebase I work with defines a utility macro called UNUSED. Its implementation is straightforward, it takes a variable (let’s call it x) as a parameter and expands it as ((void)x). The reason we use it is to avoid compiler warnings for unused variables. Why don’t we delete those variables you might ask? We usually end up with the need for UNUSED when we use preprocessor macros to include certain pieces of code only in debug builds, for example, debug logs. This is a simple enough example, right? 1 2 3 4 5 auto result = doSomething(param); #ifdef DEBUG std::cout &lt;&lt; &quot;Result: &quot; &lt;&lt; result &lt;&lt; &#39;\n&#39;; #endif UNUSED(result); In this case, if we compile in release mode, result is only used by UNUSED. If we haven’t had that, the compilation would fail in release mode. But we don’t like macros, do we? They are error-prone due to their limited readability and complicated debugging. Can we do something better? First of all, even though I agree with Arne and I dislike macros, I think that the macro is still more readable in this case than what it hides: (void)x; But since C++17 we also have the [[maybe_unused]] attribute at our hands. If an entity is declared with this label, any lack of usage emitted warning will be suppressed. Can it replace our UNUSED macro? The answer is sadly no. It’s true that [[maybe_unused]] can be used in a lot of places. Starting from C++26 it can even mark attributes as potentially unused ones. Until then, we have the following possibilities. Any class / struct or union can be declared as such: class [[maybe_unused]] Wrapper. Though I’ve barely seen a compiler complaining that a class is unused… typedefs or alias declarations using the using keyword can also be declared with [[maybe_unused]]. 1 2 using Squad [[maybe_unused]] = std::vector&lt;Player&gt;; [[maybe_unused]] typedef std::vector&lt;Player&gt; Squad; Local and non-static data members can also be [[maybe_unused]], just like functions, enumerators and enumerations. [[maybe_unused]] can even be used with structured bindings. 1 2 3 4 5 6 7 8 9 10 enum [[maybe_unused]] E { A [[maybe_unused]], B [[maybe_unused]] = 42 }; [[maybe_unused]] void foo([[maybe_unused]] int param) { [[maybe_unused]] bar = 3 * param; assert(bar); // only compiled in debug mode } Though, with structured bindings, we are reaching the limits of [[maybe_unused]]. If you use [[maybe_unused]], then all the subobjects are declared as maybe unused. You cannot simply mark specific subobjects. It’s one or nothing. 1 2 3 // both &#39;a&#39; and &#39;b&#39; might be unused // you cannot have only one of them [[maybe_unused]] [[maybe_unused]] auto [a, b] = std::make_pair(42, 0.23); So why did I say that it cannot replace the UNUSED macro? Well, there is one thing it cannot mark maybe unused. Lambda captures. If you have a lambda capture that will be only part of the debug build, the release build will complain. And you have no way to use [[maybe_unused]] with a lambda capture. When this question came up at a mailing list, the answer of a committee member was that you should use (void)x;, as it means less clutter and it’s easier to read and maintain. Quite ironic as this solution can be always used, yet [[maybe_unused]] seems superior in terms of readability. 1 2 3 4 5 6 7 auto foo = doSomething(param); auto callback = [&amp;foo] () { #ifdef DEBUG std::cout &lt;&lt; &quot;foo: &quot; &lt;&lt; foo &lt;&lt; &#39;\n&#39;; #endif UNUSED(result); // or (void)result; }; Too bad. What can we do? We can keep using our good old UNUSED macro. Conclusion In this article, we’ve seen that the [[maybe_unused]] label can help us suppress compiler warnings for variables (and other entities) that are only used in certain builds. Sadly, it doesn’t work in all situations, you cannot use it with lambda captures. In those situations, we still need other solutions, such as plain cast to void or a macro. Connect deeper If you liked this article, please hit on the like button, subscribe to my newsletter and let’s connect on Twitter!" /><link rel="canonical" href="https://www.sandordargo.com/blog/2024/06/05/the-limits-of-maybe-unused" /><meta property="og:url" content="https://www.sandordargo.com/blog/2024/06/05/the-limits-of-maybe-unused" /><meta property="og:site_name" content="Sandor Dargo’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-06-05T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="The limits of [[maybe_unused]]" /><meta name="twitter:site" content="@SandorDargo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-06-05T00:00:00+02:00","datePublished":"2024-06-05T00:00:00+02:00","description":"The codebase I work with defines a utility macro called UNUSED. Its implementation is straightforward, it takes a variable (let’s call it x) as a parameter and expands it as ((void)x). The reason we use it is to avoid compiler warnings for unused variables. Why don’t we delete those variables you might ask? We usually end up with the need for UNUSED when we use preprocessor macros to include certain pieces of code only in debug builds, for example, debug logs. This is a simple enough example, right? 1 2 3 4 5 auto result = doSomething(param); #ifdef DEBUG std::cout &lt;&lt; &quot;Result: &quot; &lt;&lt; result &lt;&lt; &#39;\\n&#39;; #endif UNUSED(result); In this case, if we compile in release mode, result is only used by UNUSED. If we haven’t had that, the compilation would fail in release mode. But we don’t like macros, do we? They are error-prone due to their limited readability and complicated debugging. Can we do something better? First of all, even though I agree with Arne and I dislike macros, I think that the macro is still more readable in this case than what it hides: (void)x; But since C++17 we also have the [[maybe_unused]] attribute at our hands. If an entity is declared with this label, any lack of usage emitted warning will be suppressed. Can it replace our UNUSED macro? The answer is sadly no. It’s true that [[maybe_unused]] can be used in a lot of places. Starting from C++26 it can even mark attributes as potentially unused ones. Until then, we have the following possibilities. Any class / struct or union can be declared as such: class [[maybe_unused]] Wrapper. Though I’ve barely seen a compiler complaining that a class is unused… typedefs or alias declarations using the using keyword can also be declared with [[maybe_unused]]. 1 2 using Squad [[maybe_unused]] = std::vector&lt;Player&gt;; [[maybe_unused]] typedef std::vector&lt;Player&gt; Squad; Local and non-static data members can also be [[maybe_unused]], just like functions, enumerators and enumerations. [[maybe_unused]] can even be used with structured bindings. 1 2 3 4 5 6 7 8 9 10 enum [[maybe_unused]] E { A [[maybe_unused]], B [[maybe_unused]] = 42 }; [[maybe_unused]] void foo([[maybe_unused]] int param) { [[maybe_unused]] bar = 3 * param; assert(bar); // only compiled in debug mode } Though, with structured bindings, we are reaching the limits of [[maybe_unused]]. If you use [[maybe_unused]], then all the subobjects are declared as maybe unused. You cannot simply mark specific subobjects. It’s one or nothing. 1 2 3 // both &#39;a&#39; and &#39;b&#39; might be unused // you cannot have only one of them [[maybe_unused]] [[maybe_unused]] auto [a, b] = std::make_pair(42, 0.23); So why did I say that it cannot replace the UNUSED macro? Well, there is one thing it cannot mark maybe unused. Lambda captures. If you have a lambda capture that will be only part of the debug build, the release build will complain. And you have no way to use [[maybe_unused]] with a lambda capture. When this question came up at a mailing list, the answer of a committee member was that you should use (void)x;, as it means less clutter and it’s easier to read and maintain. Quite ironic as this solution can be always used, yet [[maybe_unused]] seems superior in terms of readability. 1 2 3 4 5 6 7 auto foo = doSomething(param); auto callback = [&amp;foo] () { #ifdef DEBUG std::cout &lt;&lt; &quot;foo: &quot; &lt;&lt; foo &lt;&lt; &#39;\\n&#39;; #endif UNUSED(result); // or (void)result; }; Too bad. What can we do? We can keep using our good old UNUSED macro. Conclusion In this article, we’ve seen that the [[maybe_unused]] label can help us suppress compiler warnings for variables (and other entities) that are only used in certain builds. Sadly, it doesn’t work in all situations, you cannot use it with lambda captures. In those situations, we still need other solutions, such as plain cast to void or a macro. Connect deeper If you liked this article, please hit on the like button, subscribe to my newsletter and let’s connect on Twitter!","headline":"The limits of [[maybe_unused]]","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sandordargo.com/blog/2024/06/05/the-limits-of-maybe-unused"},"url":"https://www.sandordargo.com/blog/2024/06/05/the-limits-of-maybe-unused"}</script><title>The limits of `[[maybe_unused]]` | Sandor Dargo's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-89625019-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-89625019-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/SANDOR_DARGO_ROUND.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sandor Dargo's Blog</a></div><div class="site-subtitle font-italic">On C++, software development and books</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/dailycpp/" class="nav-link"> <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>DAILY C++</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HI...</span> </a></ul><ul class="w-100"><li class="nav-item"> <a href="https://www.patreon.com/sandordargo" class="nav-link"> <img src="https://c5.patreon.com/external/logo/become_a_patron_button.png"></a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sandordargo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/SandorDargo" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sandor.dargo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Blog </a> </span> <span> <a href="/2024"> 2024 </a> </span> <span> <a href="/06"> 06 </a> </span> <span> <a href="/05"> 05 </a> </span> <span>The limits of `[[maybe_unused]]`</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>The limits of `[[maybe_unused]]`</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sandor Dargo </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 5, 2024, 12:00 AM +0200" prep="on" > Jun 5, 2024 <i class="unloaded">2024-06-05T00:00:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="671 words">3 min</span></div></div><div class="post-content"><p>The codebase I work with defines a utility macro called <code class="language-plaintext highlighter-rouge">UNUSED</code>. Its implementation is straightforward, it takes a variable (let’s call it <code class="language-plaintext highlighter-rouge">x</code>) as a parameter and expands it as <code class="language-plaintext highlighter-rouge">((void)x)</code>. The reason we use it is to avoid compiler warnings for unused variables.</p><p>Why don’t we delete those variables you might ask? We usually end up with the need for <code class="language-plaintext highlighter-rouge">UNUSED</code> when we use preprocessor macros to include certain pieces of code only in debug builds, for example, debug logs. This is a simple enough example, right?</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">doSomething</span><span class="p">(</span><span class="n">param</span><span class="p">);</span>
<span class="cp">#ifdef DEBUG
</span>    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Result: "</span> <span class="o">&lt;&lt;</span> <span class="n">result</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="cp">#endif
</span><span class="n">UNUSED</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
</pre></table></code></div></div><p>In this case, if we compile in release mode, <code class="language-plaintext highlighter-rouge">result</code> is only used by <code class="language-plaintext highlighter-rouge">UNUSED</code>. If we haven’t had that, the compilation would fail in release mode.</p><p>But we don’t like macros, do we? <a href="https://arne-mertz.de/2019/03/macro-evil/">They are error-prone due to their limited readability and complicated debugging.</a></p><p>Can we do something better?</p><p>First of all, even though I agree with Arne and I dislike macros, I think that the macro is still more readable in this case than what it hides: <code class="language-plaintext highlighter-rouge">(void)x;</code></p><p>But since C++17 we also have the <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code> attribute at our hands. If an entity is declared with this label, any lack of usage emitted warning will be suppressed.</p><p>Can it replace our <code class="language-plaintext highlighter-rouge">UNUSED</code> macro?</p><p>The answer is sadly no.</p><p>It’s true that <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code> can be used in a lot of places.</p><p>Starting from C++26 it can even mark attributes as potentially unused ones. Until then, we have the following possibilities.</p><p>Any <code class="language-plaintext highlighter-rouge">class</code> / <code class="language-plaintext highlighter-rouge">struct</code> or <code class="language-plaintext highlighter-rouge">union</code> can be declared as such: <code class="language-plaintext highlighter-rouge">class [[maybe_unused]] Wrapper</code>. Though I’ve barely seen a compiler complaining that a class is unused…</p><p><code class="language-plaintext highlighter-rouge">typedef</code>s or alias declarations using the <code class="language-plaintext highlighter-rouge">using</code> keyword can also be declared with <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code>.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="n">Squad</span> <span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="k">typedef</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Player</span><span class="o">&gt;</span> <span class="n">Squad</span><span class="p">;</span>
</pre></table></code></div></div><p>Local and non-static data members can also be <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code>, just like functions, enumerators and enumerations. <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code> can even be used with structured bindings.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">enum</span> <span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="n">E</span> <span class="p">{</span>
	<span class="n">A</span> <span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]],</span>
	<span class="n">B</span> <span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">42</span>
<span class="p">};</span>


<span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="kt">void</span> <span class="nf">foo</span><span class="p">([[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="kt">int</span> <span class="n">param</span><span class="p">)</span> <span class="p">{</span>
	<span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="n">bar</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">param</span><span class="p">;</span>
	<span class="n">assert</span><span class="p">(</span><span class="n">bar</span><span class="p">);</span> <span class="c1">// only compiled in debug mode</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Though, with structured bindings, we are reaching the limits of <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code>. If you use <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code>, then all the subobjects are declared as <em>maybe unused</em>. You cannot simply mark specific subobjects. It’s one or nothing.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c1">// both 'a' and 'b' might be unused</span>
<span class="c1">// you cannot have only one of them [[maybe_unused]]</span>
<span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span> <span class="k">auto</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_pair</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="mf">0.23</span><span class="p">);</span>
</pre></table></code></div></div><p>So why did I say that it cannot replace the <code class="language-plaintext highlighter-rouge">UNUSED</code> macro?</p><p>Well, there is one thing it cannot mark maybe unused. Lambda captures.</p><p>If you have a lambda capture that will be only part of the debug build, the release build will complain. And you have no way to use <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code> with a lambda capture. When this question came up at a mailing list, <a href="https://lists.isocpp.org/std-proposals/2019/12/0827.php">the answer of a committee member</a> was that you should use <code class="language-plaintext highlighter-rouge">(void)x;</code>, as it means less clutter and it’s easier to read and maintain. Quite ironic as this solution can be always used, yet <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code> seems superior in terms of readability.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">auto</span> <span class="n">foo</span> <span class="o">=</span> <span class="n">doSomething</span><span class="p">(</span><span class="n">param</span><span class="p">);</span>
<span class="k">auto</span> <span class="n">callback</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">foo</span><span class="p">]</span> <span class="p">()</span> <span class="p">{</span>
	<span class="cp">#ifdef DEBUG
</span>	    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"foo: "</span> <span class="o">&lt;&lt;</span> <span class="n">foo</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
	<span class="cp">#endif
</span>    <span class="n">UNUSED</span><span class="p">(</span><span class="n">result</span><span class="p">);</span> <span class="c1">// or (void)result;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Too bad.</p><p>What can we do?</p><p>We can keep using our good old <code class="language-plaintext highlighter-rouge">UNUSED</code> macro.</p><h2 id="conclusion">Conclusion</h2><p>In this article, we’ve seen that the <code class="language-plaintext highlighter-rouge">[[maybe_unused]]</code> label can help us suppress compiler warnings for variables (and other entities) that are only used in certain builds. Sadly, it doesn’t work in all situations, you cannot use it with lambda captures. In those situations, we still need other solutions, such as plain cast to void or a macro.</p><h2 id="connect-deeper">Connect deeper</h2><p>If you liked this article, please</p><ul><li>hit on the like button,<li><a href="http://eepurl.com/gvcv1j">subscribe to my newsletter</a><li>and let’s connect on <a href="https://twitter.com/SandorDargo">Twitter</a>!</ul><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a> <a href="/tags/attributes/" class="post-tag no-text-decoration" >attributes</a> <a href="/tags/macros/" class="post-tag no-text-decoration" >macros</a> <a href="/tags/maybe-unused/" class="post-tag no-text-decoration" >maybe_unused</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a><div class="share-wrapper"> <a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The limits of `[[maybe_unused]]` - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2024/06/05/the-limits-of-maybe-unused" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The limits of `[[maybe_unused]]` - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2024/06/05/the-limits-of-maybe-unused" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=The limits of `[[maybe_unused]]` - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2024/06/05/the-limits-of-maybe-unused" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=The limits of `[[maybe_unused]]` - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2024/06/05/the-limits-of-maybe-unused" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2025/10/22/trip-report-budapest-cpp">Trip report: Budapest C++ - Breaking & Building C++</a><li><a href="/blog/2025/10/01/cpp26-optional-of-reference">C++26: std::optional&lt;T&amp;&gt;</a><li><a href="/blog/2025/09/24/trip-report-cppcon-2025">Trip report: CppCon 2025</a><li><a href="/blog/2025/07/23/format-your-own-type-part-1">Format your own type (Part 1)</a><li><a href="/blog/2025/07/02/cpponsea-trip-report">Trip report: C++ On Sea 2025</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self-improvement</a> <a class="post-tag" href="/tags/management/">management</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2022/12/14/cpp23-attributes"><div class="card-body"> <span class="timeago small" > Dec 14, 2022 <i class="unloaded">2022-12-14T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>C++23: attributes</h3><div class="text-muted small"><p> C++11 introduced attributes. Even though the language itself only came with two ([[noreturn]] and [[carries_dependency]]), it also provided the unified standard syntax for *implementation-defined l...</p></div></div></a></div><div class="card"> <a href="/blog/2024/12/18/cpp26-delete-with-a-reason"><div class="card-body"> <span class="timeago small" > Dec 18, 2024 <i class="unloaded">2024-12-18T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>C++26: Delete with a reason</h3><div class="text-muted small"><p> Let’s start exploring C++26 with a simple but useful change. Thanks to Yihe Li’s proposal (2573R2), when we =delete a special member function or a function overload, we can specify a reason. This ...</p></div></div></a></div><div class="card"> <a href="/blog/2025/01/29/cpp26-attributes-structured-bindings"><div class="card-body"> <span class="timeago small" > Jan 29 <i class="unloaded">2025-01-29T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>C++26: attributes in structured bindings</h3><div class="text-muted small"><p> We recently talked about C++26’s unnamed placeholder and how useful it will be with structured bindings. Before unnamed placeholders, one of our problems was that in structured bindings we could no...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2024/05/29/cpp23-chrono" class="btn btn-outline-primary" prompt="Older"><p>C++23: chrono related changes</p></a> <a href="/blog/2024/06/12/builds-and-dependencies" class="btn btn-outline-primary" prompt="Newer"><p>Limit the number of library dependencies</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//sandordargo-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'The limits of `[[maybe_unused]]`'; this.page.url = 'https://www.sandordargo.com/blog/2024/06/05/the-limits-of-maybe-unused'; this.page.identifier = '/blog/2024/06/05/the-limits-of-maybe-unused'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><div id="amzn-assoc-ad-be5a767b-3346-40aa-bc00-2eff0ce33d2b"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=be5a767b-3346-40aa-bc00-2eff0ce33d2b"></script> <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us16.list-manage.com","uuid":"b073dbd5c29322302f59a8cd8","lid":"d26240427e"}) })</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/SandorDargo">Sandor Dargo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self improvement</a> <a class="post-tag" href="/tags/management/">management</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sandordargo.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
