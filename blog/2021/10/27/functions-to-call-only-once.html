<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Functions to be called only once in C++" /><meta property="og:locale" content="en_US" /><meta name="description" content="In this article, we are going to discuss how we can make sure member functions are called no more than once while their enclosing object is alive." /><meta property="og:description" content="In this article, we are going to discuss how we can make sure member functions are called no more than once while their enclosing object is alive." /><link rel="canonical" href="https://www.sandordargo.com/blog/2021/10/27/functions-to-call-only-once" /><meta property="og:url" content="https://www.sandordargo.com/blog/2021/10/27/functions-to-call-only-once" /><meta property="og:site_name" content="Sandor Dargo’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-27T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Functions to be called only once in C++" /><meta name="twitter:site" content="@SandorDargo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-10-27T00:00:00+02:00","datePublished":"2021-10-27T00:00:00+02:00","description":"In this article, we are going to discuss how we can make sure member functions are called no more than once while their enclosing object is alive.","headline":"Functions to be called only once in C++","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sandordargo.com/blog/2021/10/27/functions-to-call-only-once"},"url":"https://www.sandordargo.com/blog/2021/10/27/functions-to-call-only-once"}</script><title>Functions to be called only once in C++ | Sandor Dargo's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-89625019-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-89625019-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/SANDOR_DARGO_ROUND.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sandor Dargo's Blog</a></div><div class="site-subtitle font-italic">On C++, software development and books</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/dailycpp/" class="nav-link"> <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>DAILY C++</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HI...</span> </a></ul><ul class="w-100"><li class="nav-item"> <a href="https://www.patreon.com/sandordargo" class="nav-link"> <img src="https://c5.patreon.com/external/logo/become_a_patron_button.png"></a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sandordargo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/SandorDargo" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sandor.dargo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Blog </a> </span> <span> <a href="/2021"> 2021 </a> </span> <span> <a href="/10"> 10 </a> </span> <span> <a href="/27"> 27 </a> </span> <span>Functions to be called only once in C++</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Functions to be called only once in C++</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sandor Dargo </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Oct 27, 2021, 12:00 AM +0200" prep="on" > Oct 27, 2021 <i class="unloaded">2021-10-27T00:00:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1301 words">7 min</span></div></div><div class="post-content"><p>In this article, we are going to discuss how we can make sure member functions are called no more than once while their enclosing object is alive.</p><p>There can be different motivations for having such functions. Certain operations might be very costly, so we don’t want to recompute the results several times, or maybe logically it doesn’t make sense to call a function twice.</p><p>As we’re going to see, the different motivations can lead to different solutions.</p><h2 id="very-costly-operations">Very costly operations</h2><p>Imagine that a function has something very costly to perform. Maybe it has to retrieve something from the database, or from the network, maybe simply it’s just very CPU intensive and we want to avoid doing that work twice.</p><h3 id="cache-the-data">Cache the data</h3><p>A simple and clean solution can be that when you call the costly function the first time, it saves the data in a private member. For later calls, the result is simply retrieved from that member instead of repeating the computation.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="c1">// ...</span>
  <span class="n">CostlyResult</span> <span class="n">getCostly</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_result</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span> <span class="p">{</span>
      <span class="n">computeCostlyResult</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">m_result</span><span class="p">;</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">CostlyResult</span> <span class="n">m_result</span><span class="p">;</span>
<span class="p">}</span>

</pre></table></code></div></div><p>In this simple example, we default initialize <code class="language-plaintext highlighter-rouge">m_result</code> of type <code class="language-plaintext highlighter-rouge">CostlyResult</code> which has the means to check whether it already stores the outcome of the costly operations. For practical reasons, it’s called <code class="language-plaintext highlighter-rouge">CostlyResult::empty</code> but there can be other ways to make such checks. You might even use a helper member to track if the function has been already called.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">CostlyResult</span> <span class="n">getCostly</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">m_result_initialized</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">computeCostlyResult</span><span class="p">();</span>
      <span class="n">m_result_initialized</span> <span class="o">=</span> <span class="nb">true</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">m_result</span><span class="p">;</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">CostlyResult</span> <span class="n">m_result</span><span class="p">;</span>
  <span class="kt">bool</span> <span class="n">m_result_initialized</span><span class="p">{</span><span class="nb">false</span><span class="p">};</span>
<span class="p">};</span>
</pre></table></code></div></div><p>The goal is clearly to avoid the computation being done twice. If the object lives long and the result might change, you might want to provide means to trigger a refresh of the data. As long as it doesn’t happen automatically but the user of the class had to pass in a special flag or call a function, it’s okay. The computation won’t be triggered accidentally.</p><p>But what if you really want to restrict the number of calls and not just the computations?</p><h3 id="have-a-counter">Have a counter</h3><p>Instead of checking whether the <code class="language-plaintext highlighter-rouge">m_result</code> member was initialized, we can have a counter that counts how many times <code class="language-plaintext highlighter-rouge">getCostly</code> was called.</p><p>We can set a threshold and if there are more calls than that, we can raise an error like in the below example. Note that if the threshold is only one, meaning that the function can be called only once, instead of using a counter, we can fall back to a <code class="language-plaintext highlighter-rouge">bool</code> that is set after the first call - like in the previous example.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdexcept&gt;</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">CostlyResult</span><span class="p">{};</span>

<span class="k">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="c1">// ...</span>
  <span class="n">CostlyResult</span> <span class="n">getCostly</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">number_of_costly_calls</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"MyClass::getCostly() can be called only once"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="o">++</span><span class="n">number_of_costly_calls</span><span class="p">;</span>
    <span class="k">return</span> <span class="nf">computeCostlyResult</span><span class="p">();</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">CostlyResult</span> <span class="nf">computeCostlyResult</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{};</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">number_of_costly_calls</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">MyClass</span> <span class="n">mc</span><span class="p">;</span>
  <span class="n">mc</span><span class="p">.</span><span class="n">getCostly</span><span class="p">();</span>
  <span class="n">mc</span><span class="p">.</span><span class="n">getCostly</span><span class="p">();</span> <span class="c1">// ERROR THROWN</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In this example, you can also see that we called <code class="language-plaintext highlighter-rouge">getCostly()</code>, yet we didn’t store the result. That’s probably a mistake and a waste of resources. Since C++17 we shall use <code class="language-plaintext highlighter-rouge">[[nodiscard]]</code> to have a compile-time warning in such situations and change <code class="language-plaintext highlighter-rouge">getCostly</code> as such:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="n">CostlyResult</span> <span class="nf">getCostly</span><span class="p">();</span>
</pre></table></code></div></div><p>Now let’s jump to our other main motivation to avoid multiple calls to the same functions.</p><h2 id="multiple-calls-are-illogical">Multiple calls are illogical</h2><p>What can we do if it logically doesn’t make sense to call a function more than once?</p><p>For sure, caching is not needed, we want to completely avoid multiple calls.</p><p>Then we have to ask ourselves a question. Will the call to the constrained function be the very last call on the object?</p><p>If no…</p><h3 id="implement-a-flag">Implement a flag</h3><p>If the given function call is not the last one on the object, we can take the idea of the counter from the previous sections and implement it strictly with a flag, and of course with the <code class="language-plaintext highlighter-rouge">[[nodiscard]]</code> attribute in case it returns something.</p><p>Let’s also have a runtime error in case we go against the rule we set:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;stdexcept&gt;</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">CostlyResult</span><span class="p">{};</span>

<span class="k">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="c1">// ...</span>
  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="n">CostlyResult</span> <span class="n">getCostly</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">getCostly_already_called</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">"MyClass::getCostly() can be called only once"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">getCostly_already_called</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="k">return</span> <span class="nf">computeCostlyResult</span><span class="p">();</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">CostlyResult</span> <span class="nf">computeCostlyResult</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">;</span>
  <span class="p">}</span>
  <span class="kt">bool</span> <span class="n">getCostly_already_called</span><span class="p">{</span><span class="nb">false</span><span class="p">};</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">MyClass</span> <span class="n">mc</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">r</span> <span class="o">=</span> <span class="n">mc</span><span class="p">.</span><span class="n">getCostly</span><span class="p">();</span>
  <span class="c1">//r = mc.getCostly();</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="destructive-separation-move-away-and-call">Destructive separation: move away and call</h3><p>This solution is borrowed by <a href="https://youtu.be/nLSm3Haxz0I?t=2523">Matt Godbolt and his talk at C++ On Sea 2020</a>.</p><p>We can go this way if the function call should be the last one on the object. After this call, our object won’t - necessarily - be in a usable shape.</p><p>The first thing to do is to add a <code class="language-plaintext highlighter-rouge">[[nodiscard]]</code> attribute if it has any return type so that people don’t accidentally forget to save the results in a variable.</p><p>The other step is something more interesting and at the first sight even esoteric.</p><p>We have to add the <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> qualifier to the function declaration - something I wrote about <a href="https://www.sandordargo.com/blog/2018/11/25/override-r-and-l0-values#use--or--for-function-overloading">here</a>.</p><p>This means that the function can only be called if the object:</p><ul><li>is temporary<li>is about to fall out of scope<li>has been moved from</ul><p>In other words, the object is gone after the call.</p><p>Let’s have a look at an example:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">CostlyResult</span><span class="p">{};</span>

<span class="k">class</span> <span class="nc">MyClass</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="c1">// ...</span>
  <span class="p">[[</span><span class="n">nodiscard</span><span class="p">]]</span> <span class="n">CostlyResult</span> <span class="n">getCostly</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">{};</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">MyClass</span> <span class="n">mc</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">r</span> <span class="o">=</span> <span class="n">mc</span><span class="p">.</span><span class="n">getCostly</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The compiler says now that we are ignoring the <code class="language-plaintext highlighter-rouge">&amp;&amp;</code> qualifier. We even got a compile-time check so that it should be called only once!</p><pre><code class="language-language">main.cpp: In function 'int main()':
main.cpp:16:24: error: passing 'MyClass' as 'this' argument discards qualifiers [-fpermissive]
   16 |   auto r = mc.getCostly();
      |            ~~~~~~~~~~~~^~
main.cpp:8:30: note:   in call to 'CostlyResult MyClass::getCostly() &amp;&amp;'
    8 |   [[nodiscard]] CostlyResult getCostly() &amp;&amp; {
      |                              ^~~~~~~~~

</code></pre><p>Not so fast. The easiest way to get rid of the error message is to move away from <code class="language-plaintext highlighter-rouge">mc</code>:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">auto</span> <span class="n">r</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">mc</span><span class="p">).</span><span class="n">getCostly</span><span class="p">();</span>
</pre></table></code></div></div><p>We can do the same thing again!</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">auto</span> <span class="n">r</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">mc</span><span class="p">).</span><span class="n">getCostly</span><span class="p">();</span>
<span class="k">auto</span> <span class="n">r2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">mc</span><span class="p">).</span><span class="n">getCostly</span><span class="p">();</span>
</pre></table></code></div></div><p>Of course, you should not do this, but it’s possible and the compiler will not shout. At least, when you see the first line, the <code class="language-plaintext highlighter-rouge">std::move</code> should ring a bell that you shouldn’t use that object anymore. But nothing prevents you.</p><p>A better way would be to wrap the call in a function and have the call at the last statement:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="n">CostlyResult</span> <span class="nf">getThatCostly</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">MyClass</span> <span class="n">mc</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">mc</span><span class="p">).</span><span class="n">getCostly</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Note that in the video, std::move is not used in this case, (but with the compiler I use,) it doesn’t work without the <code class="language-plaintext highlighter-rouge">move</code>. Anyway, it’s the last line, so for sure, you’re not going to reuse the object.</p><h2 id="conclusion">Conclusion</h2><p>In this article, we’ve seen different solutions to prevent functions to be called more than once, or at least to trigger their computations more than once.</p><p>Depending on the motivations, there are different solutions, such as caching, throwing exceptions or using function overloads.</p><p>Do you have other solutions in mind?</p><h2 id="connect-deeper">Connect deeper</h2><p>If you liked this article, please</p><ul><li>hit on the like button,<li><a href="http://eepurl.com/gvcv1j">subscribe to my newsletter</a><li>and let’s connect on <a href="https://twitter.com/SandorDargo">Twitter</a>!</ul><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a> <a href="/tags/functions/" class="post-tag no-text-decoration" >functions</a> <a href="/tags/oop/" class="post-tag no-text-decoration" >oop</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a><div class="share-wrapper"> <a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Functions to be called only once in C++ - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2021/10/27/functions-to-call-only-once" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Functions to be called only once in C++ - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2021/10/27/functions-to-call-only-once" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Functions to be called only once in C++ - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2021/10/27/functions-to-call-only-once" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=Functions to be called only once in C++ - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2021/10/27/functions-to-call-only-once" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2026/01/21/clocks-part-8-cpp20-timezones">Time in C++: C++20 Brought Us Time Zones</a><li><a href="/blog/2019/04/10/lesson-of-a-booking-dont-trust-the-system">Lesson of a booking: Don't trust the system!</a><li><a href="/blog/2020/07/22/always-catch-exceptions-by-reference">Why should we always catch exceptions by reference?</a><li><a href="/blog/2020/11/28/emergent-design">Emergent Design: The Evolutionary Nature of Professional Software Development by Scott Bain</a><li><a href="/blog/2021/10/06/airy-code-reviews">Bring some fresh AIR and write effective code review comments</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self-improvement</a> <a class="post-tag" href="/tags/management/">management</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2024/05/15/when-includes-are-needed"><div class="card-body"> <span class="timeago small" > May 15, 2024 <i class="unloaded">2024-05-15T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Two cases when forward declaring is not enough</h3><div class="text-muted small"><p> Let me share two cases when I had to include some header files instead of just using forward declarations. I was surprised by both at first. As you will see, one was a simple overlook, but the othe...</p></div></div></a></div><div class="card"> <a href="/blog/2020/01/08/default-member-initialization"><div class="card-body"> <span class="timeago small" > Jan 8, 2020 <i class="unloaded">2020-01-08T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Default Member Initializers in C++</h3><div class="text-muted small"><p> This topic came up recently during a coding dojo in our department, while we were working on the ugly trivia kata. We wanted to extract a struct, containing the player data. Later we wanted to turn...</p></div></div></a></div><div class="card"> <a href="/blog/2020/04/01/private-inheritanc-vs-composition"><div class="card-body"> <span class="timeago small" > Apr 1, 2020 <i class="unloaded">2020-04-01T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The quest of private inheritance in C++</h3><div class="text-muted small"><p> I love mentoring. It requires a huge quantity of humility, and if you possess it, it will bring you tremendous benefits on a human as well as on a technical level. A few weeks ago, I met with on...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2021/10/23/the-ape-that-understood-the-universe" class="btn btn-outline-primary" prompt="Older"><p>The Ape That Understood The Universe by Steve Stewart-Williams</p></a> <a href="/blog/2021/11/03/5-sources-of-success-how-not-to-lose-confidence" class="btn btn-outline-primary" prompt="Newer"><p>5 sources of success: how not to lose confidence after a promotion?</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//sandordargo-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Functions to be called only once in C++'; this.page.url = 'https://www.sandordargo.com/blog/2021/10/27/functions-to-call-only-once'; this.page.identifier = '/blog/2021/10/27/functions-to-call-only-once'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><div id="amzn-assoc-ad-be5a767b-3346-40aa-bc00-2eff0ce33d2b"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=be5a767b-3346-40aa-bc00-2eff0ce33d2b"></script> <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us16.list-manage.com","uuid":"b073dbd5c29322302f59a8cd8","lid":"d26240427e"}) })</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://twitter.com/SandorDargo">Sandor Dargo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self improvement</a> <a class="post-tag" href="/tags/management/">management</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sandordargo.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
