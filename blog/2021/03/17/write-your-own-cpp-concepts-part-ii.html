<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="How to write your own C++ concepts? Part II." /><meta property="og:locale" content="en_US" /><meta name="description" content="Last week we started to discuss how to write our own concepts. Our first step was to combine different already existing concepts, then we continued with declaring constraints on the existence of certain operations, certain methods." /><meta property="og:description" content="Last week we started to discuss how to write our own concepts. Our first step was to combine different already existing concepts, then we continued with declaring constraints on the existence of certain operations, certain methods." /><link rel="canonical" href="https://www.sandordargo.com/blog/2021/03/17/write-your-own-cpp-concepts-part-ii" /><meta property="og:url" content="https://www.sandordargo.com/blog/2021/03/17/write-your-own-cpp-concepts-part-ii" /><meta property="og:site_name" content="Sandor Dargo’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-03-17T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="How to write your own C++ concepts? Part II." /><meta name="twitter:site" content="@SandorDargo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-02-11T20:11:35+01:00","datePublished":"2021-03-17T00:00:00+01:00","description":"Last week we started to discuss how to write our own concepts. Our first step was to combine different already existing concepts, then we continued with declaring constraints on the existence of certain operations, certain methods.","headline":"How to write your own C++ concepts? Part II.","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sandordargo.com/blog/2021/03/17/write-your-own-cpp-concepts-part-ii"},"url":"https://www.sandordargo.com/blog/2021/03/17/write-your-own-cpp-concepts-part-ii"}</script><title>How to write your own C++ concepts? Part II. | Sandor Dargo's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-89625019-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-89625019-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/SANDOR_DARGO_ROUND.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sandor Dargo's Blog</a></div><div class="site-subtitle font-italic">On C++, software development and books</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/dailycpp/" class="nav-link"> <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>DAILY C++</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HI...</span> </a></ul><ul class="w-100"><li class="nav-item"> <a href="https://www.patreon.com/sandordargo" class="nav-link"> <img src="https://c5.patreon.com/external/logo/become_a_patron_button.png"></a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sandordargo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/SandorDargo" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sandor.dargo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Blog </a> </span> <span> <a href="/2021"> 2021 </a> </span> <span> <a href="/03"> 03 </a> </span> <span> <a href="/17"> 17 </a> </span> <span>How to write your own C++ concepts? Part II.</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>How to write your own C++ concepts? Part II.</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sandor Dargo </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Mar 17, 2021, 12:00 AM +0100" prep="on" > Mar 17, 2021 <i class="unloaded">2021-03-17T00:00:00+01:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Sun, Feb 11, 2024, 8:11 PM +0100" prefix="Updated " > Feb 11, 2024 <i class="unloaded">2024-02-11T20:11:35+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2135 words">11 min</span></div></div><div class="post-content"><p>Last week we started to discuss <a href="https://www.sandordargo.com/blog/2021/03/10/write-your-own-cpp-concepts-part-i">how to write our own concepts</a>. Our first step was to combine different <a href="https://www.sandordargo.com/blog/2021/03/03/cpp-concepts-in-standard-library">already existing concepts</a>, then we continued with declaring constraints on the existence of certain operations, certain methods.</p><p>Today, we are going to discover how to express our requirements on function return types, how to write type requirements (and what they are) and we are going to finish with discussing nested requirements.</p><h2 id="write-your-own-constraints">Write your own constraints</h2><p>Last time, we had an example with the concept <code class="language-plaintext highlighter-rouge">HasSquare</code>. It accepts any type that has a <code class="language-plaintext highlighter-rouge">square</code> function regardless of the return type.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;concepts&gt;</span><span class="cp">
</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">HasSquare</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">t</span><span class="p">.</span><span class="n">square</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">IntWithoutSquare</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">IntWithoutSquare</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_num</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">m_num</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">IntWithSquare</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">IntWithSquare</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_num</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="nf">square</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">m_num</span> <span class="o">*</span> <span class="n">m_num</span><span class="p">;</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">m_num</span><span class="p">;</span>
<span class="p">};</span>


<span class="kt">void</span> <span class="nf">printSquare</span><span class="p">(</span><span class="n">HasSquare</span> <span class="k">auto</span> <span class="n">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">number</span><span class="p">.</span><span class="n">square</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">printSquare</span><span class="p">(</span><span class="n">IntWithoutSquare</span><span class="p">{</span><span class="mi">4</span><span class="p">});</span> <span class="c1">// error: use of function 'void printSquare(auto:11) [with auto:11 = IntWithoutSquare]' with unsatisfied constraints, </span>
                                    <span class="c1">// the required expression 't.square()' is invalid</span>
  <span class="n">printSquare</span><span class="p">(</span><span class="n">IntWithSquare</span><span class="p">{</span><span class="mi">5</span><span class="p">});</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Now let’s continue with constraining the return types.</p><h3 id="requirements-on-return-types-aka-compound-requirements">Requirements on return types (a.k.a compound requirements)</h3><p>We’ve seen how to write a requirement expressing the need of a certain API, a certain function.</p><p>But did we also constrain the return type of those functions?</p><p>No, we didn’t. <code class="language-plaintext highlighter-rouge">IntWithSquare</code> satisfies the <code class="language-plaintext highlighter-rouge">HasSquare</code> concept both with <code class="language-plaintext highlighter-rouge">int square()</code> and <code class="language-plaintext highlighter-rouge">void square()</code>.</p><p>If you want to specify the return type, you must use something that is called a compound requirement.</p><p>Here is an example:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">HasSquare</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">{</span><span class="n">t</span><span class="p">.</span><span class="n">square</span><span class="p">()}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">convertible_to</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span> 
</pre></table></code></div></div><p>Notice the following:</p><ul><li>The expression on what you want to set a return type requirement must be surrounded by braces (<code class="language-plaintext highlighter-rouge">{}</code>), then comes an arrow (<code class="language-plaintext highlighter-rouge">-&gt;</code>) followed by the constraint of the return type.<li>A constraint cannot simply be a type. Had you written simply <code class="language-plaintext highlighter-rouge">int</code>, you would receive an error message: <em>return-type-requirement is not a type-constraint.</em> The original concepts TS allowed the direct usage of types, so if you experimented with that, you might be surprised by this error. This possibility was removed by <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2019/p1452r2.html">P1452R2</a>.</ul><p>There are a number of reasons for this removal. One of the motivations was that it would interfere with a future direction of wanting to adopt a generalized form of <code class="language-plaintext highlighter-rouge">auto</code>, like <code class="language-plaintext highlighter-rouge">vector&lt;auto&gt;</code> or <code class="language-plaintext highlighter-rouge">vector&lt;Concept&gt;.</code></p><p>So instead of simply naming a type you have to choose a concept! If you want to set the return type one of the two following options will satisfy your needs:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="p">{</span><span class="n">t</span><span class="p">.</span><span class="n">square</span><span class="p">()}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">{</span><span class="n">t</span><span class="p">.</span><span class="n">square</span><span class="p">()}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">convertible_to</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
</pre></table></code></div></div><p>I think that the difference is obvious. In case of <code class="language-plaintext highlighter-rouge">std::same_as</code>, the return value must be the same as specified as the template argument, while with <code class="language-plaintext highlighter-rouge">std::convertible_to</code> conversions are allowed.</p><p>In order to demonstrate this, let’s have a look at the following example:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;concepts&gt;</span><span class="cp">
</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">HasIntSquare</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">{</span><span class="n">t</span><span class="p">.</span><span class="n">square</span><span class="p">()}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">HasConvertibleToIntSquare</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">(</span><span class="n">T</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">{</span><span class="n">t</span><span class="p">.</span><span class="n">square</span><span class="p">()}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">convertible_to</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">IntWithIntSquare</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">IntWithIntSquare</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_num</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="n">square</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">m_num</span> <span class="o">*</span> <span class="n">m_num</span><span class="p">;</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">m_num</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">IntWithLongSquare</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">IntWithLongSquare</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_num</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">long</span> <span class="n">square</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">m_num</span> <span class="o">*</span> <span class="n">m_num</span><span class="p">;</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">m_num</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">IntWithVoidSquare</span> <span class="p">{</span>
<span class="nl">public:</span>
  <span class="n">IntWithVoidSquare</span><span class="p">(</span><span class="kt">int</span> <span class="n">num</span><span class="p">)</span> <span class="o">:</span> <span class="n">m_num</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">void</span> <span class="n">square</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">m_num</span> <span class="o">*</span> <span class="n">m_num</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">m_num</span><span class="p">;</span>
<span class="p">};</span>


<span class="kt">void</span> <span class="nf">printSquareSame</span><span class="p">(</span><span class="n">HasIntSquare</span> <span class="k">auto</span> <span class="n">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">number</span><span class="p">.</span><span class="n">square</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">printSquareConvertible</span><span class="p">(</span><span class="n">HasConvertibleToIntSquare</span> <span class="k">auto</span> <span class="n">number</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">number</span><span class="p">.</span><span class="n">square</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">printSquareSame</span><span class="p">(</span><span class="n">IntWithIntSquare</span><span class="p">{</span><span class="mi">1</span><span class="p">});</span> <span class="c1">// int same as int</span>
<span class="c1">//   printSquareSame(IntWithLongSquare{2}); // long not same as int</span>
<span class="c1">//   printSquareSame(IntWithVoidSquare{3}); // void not same as int</span>
  <span class="n">printSquareConvertible</span><span class="p">(</span><span class="n">IntWithIntSquare</span><span class="p">{</span><span class="mi">4</span><span class="p">});</span> <span class="c1">// int convertible to int</span>
  <span class="n">printSquareConvertible</span><span class="p">(</span><span class="n">IntWithLongSquare</span><span class="p">{</span><span class="mi">5</span><span class="p">});</span> <span class="c1">// long convertible to int</span>
<span class="c1">//   printSquareConvertible(IntWithVoidSquare{6}); // void not convertible to int</span>
<span class="p">}</span>
<span class="cm">/*
1
16
25
*/</span>
</pre></table></code></div></div><p>In the above example, we can observe that the class with <code class="language-plaintext highlighter-rouge">void square() const</code> doesn’t satisfy either the <code class="language-plaintext highlighter-rouge">HasIntSquare</code> or the <code class="language-plaintext highlighter-rouge">HasConvertibleToIntSquare</code> concepts.</p><p><code class="language-plaintext highlighter-rouge">IntWithLongSquare</code>, so the class with the function <code class="language-plaintext highlighter-rouge">long square() const</code> doesn’t satisfy the concept <code class="language-plaintext highlighter-rouge">HasIntSquare</code> as long is not the same as <code class="language-plaintext highlighter-rouge">int</code>, but it does satisfy the <code class="language-plaintext highlighter-rouge">HasConvertibleToIntSquare</code> concept as <code class="language-plaintext highlighter-rouge">long</code> is convertible to <code class="language-plaintext highlighter-rouge">int</code>.</p><p>Class <code class="language-plaintext highlighter-rouge">IntWithIntSquare</code> satisfies both concepts as an <code class="language-plaintext highlighter-rouge">int</code> is obviously the same as <code class="language-plaintext highlighter-rouge">int</code> and it’s also convertible to an <code class="language-plaintext highlighter-rouge">int</code>.</p><h3 id="type-requirements">Type requirements</h3><p>With type requirements, we can express that a certain type is valid in a specific context. Type requirements can be used to verify that</p><ul><li>a certain nested type exists<li>a class template specialization names a type<li>an alias template specialization names a type</ul><p>You have to use the keyword <code class="language-plaintext highlighter-rouge">typename</code> along with the type name that is expected to exist:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">TypeRequirement</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">{</span>
  <span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">value_type</span><span class="p">;</span>
  <span class="k">typename</span> <span class="n">Other</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>The concept <code class="language-plaintext highlighter-rouge">TypeRequirement</code> requires that the type <code class="language-plaintext highlighter-rouge">T</code> has a nested type <code class="language-plaintext highlighter-rouge">value_type</code>, and that the class template <code class="language-plaintext highlighter-rouge">Other</code> can be instantiated with <code class="language-plaintext highlighter-rouge">T</code>.</p><p>Let’s see how it works:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">Other</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">TypeRequirement</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">{</span>
  <span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">value_type</span><span class="p">;</span>
  <span class="k">typename</span> <span class="n">Other</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">TypeRequirement</span> <span class="k">auto</span> <span class="n">myVec</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="c1">// TypeRequirement auto myInt {3}; // error: deduced initializer does not satisfy placeholder constraints ... the required type 'typename T::value_type' is invalid </span>
<span class="p">}</span>
</pre></table></code></div></div><p>The expression <code class="language-plaintext highlighter-rouge">TypeRequirement auto myVec = std::vector&lt;int&gt;{1, 2, 3}</code> (line 13) is valid.</p><p>A <code class="language-plaintext highlighter-rouge">std::vector</code> has an inner member type <code class="language-plaintext highlighter-rouge">value_type</code> (requested on line 8) and the class template <code class="language-plaintext highlighter-rouge">Other</code> can be instantiated with <code class="language-plaintext highlighter-rouge">std::vector&lt;int&gt;</code> (line 9).</p><p>At the same time, an <code class="language-plaintext highlighter-rouge">int</code> doesn’t have any member, in particular <code class="language-plaintext highlighter-rouge">value_type</code>, so it doesn’t satisfy the constraints of <code class="language-plaintext highlighter-rouge">TypeRequirement</code>.</p><p>Let’s change class template <code class="language-plaintext highlighter-rouge">Other</code> and make a requirement on the template parameter by making sure that <code class="language-plaintext highlighter-rouge">Other</code> cannot be instantiated with a <code class="language-plaintext highlighter-rouge">vector</code> of <code class="language-plaintext highlighter-rouge">int</code>s.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">requires</span> <span class="p">(</span><span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;&gt;</span><span class="p">)</span>
<span class="k">struct</span> <span class="nc">Other</span>
</pre></table></code></div></div><p>Now, the line <code class="language-plaintext highlighter-rouge">TypeRequirement auto myVec = std::vector&lt;int&gt;{1, 2, 3};</code> fails with the following error message:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>main.cpp: In function 'int main()':
main.cpp:16:55: error: deduced initializer does not satisfy placeholder constraints
   16 |   TypeRequirement auto myVec = std::vector&lt;int&gt;{1, 2, 3};
      |                                                       ^
main.cpp:16:55: note: constraints not satisfied
main.cpp:10:9:   required for the satisfaction of 'TypeRequirement&lt;std::vector&lt;int, std::allocator&lt;int&gt; &gt; &gt;'
main.cpp:10:27:   in requirements  [with T = std::vector&lt;int, std::allocator&lt;int&gt; &gt;]
main.cpp:12:12: note: the required type 'Other&lt;T&gt;' is invalid
   12 |   typename Other&lt;T&gt;;
      |   ~~~~~~~~~^~~~~~~~~
cc1plus: note: set '-fconcepts-diagnostics-depth=' to at least 2 for more detail
</pre></table></code></div></div><p>With type requirements, we can make sure that a class has a nested member type or that a template specialization is possible.</p><p>To show that a concept can be used to prove that an alias template specialization names a type, let’s take our original example and create a template alias <code class="language-plaintext highlighter-rouge">Reference</code>:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">using</span> <span class="n">Reference</span> <span class="o">=</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">;</span>
</pre></table></code></div></div><p>And use it in the concept <code class="language-plaintext highlighter-rouge">TypeRequirement</code>:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">TypeRequirement</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">{</span>
  <span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">value_type</span><span class="p">;</span>
  <span class="k">typename</span> <span class="n">Other</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">typename</span> <span class="n">Reference</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Our example should still compile:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">&gt;</span>
<span class="k">struct</span> <span class="nc">Other</span><span class="p">;</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">using</span> <span class="n">Reference</span> <span class="o">=</span> <span class="n">T</span><span class="o">&amp;</span><span class="p">;</span>


<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">TypeRequirement</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">{</span>
  <span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">value_type</span><span class="p">;</span>
  <span class="k">typename</span> <span class="n">Other</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
  <span class="k">typename</span> <span class="n">Reference</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">TypeRequirement</span> <span class="k">auto</span> <span class="n">myVec</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
<span class="p">}</span>
</pre></table></code></div></div><h3 id="nested-requirements">Nested requirements</h3><p>We can use nested requirements to specify additional constraints in a concept without introducing another named concepts.</p><p>You can think of nested requirements as one would think about lambda functions for STL algorithms. You can use lambdas to alter the behaviour of an algorithm without the need of naming a function or a function object.</p><p>In this case, you can write a constraint more suitable for your needs without the need of naming one more constraint that you’d only use in one (nested) context.</p><p>Its syntax follows the following form:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>requires constraint-expression;
</pre></table></code></div></div><p>Let’s start with a simpler example. Where the concept <code class="language-plaintext highlighter-rouge">Coupe</code> uses two other concepts <code class="language-plaintext highlighter-rouge">Car</code> and <code class="language-plaintext highlighter-rouge">Convertible</code>.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="k">struct</span> <span class="nc">AwesomeCabrio</span> <span class="p">{</span>
  <span class="kt">void</span> <span class="n">openRoof</span><span class="p">(){}</span>
  <span class="kt">void</span> <span class="nf">startEngine</span><span class="p">(){}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">CoolCoupe</span> <span class="p">{</span>
    <span class="kt">void</span> <span class="n">startEngine</span><span class="p">(){}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">C</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">Car</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">(</span><span class="n">C</span> <span class="n">car</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">car</span><span class="p">.</span><span class="n">startEngine</span><span class="p">();</span>
<span class="p">};</span>


<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">C</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">Convertible</span> <span class="o">=</span> <span class="n">Car</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span> <span class="k">requires</span> <span class="p">(</span><span class="n">C</span> <span class="n">car</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">car</span><span class="p">.</span><span class="n">openRoof</span><span class="p">();</span>
<span class="p">};</span>


<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">C</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">Coupe</span> <span class="o">=</span> <span class="n">Car</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span> <span class="k">requires</span> <span class="p">(</span><span class="n">C</span> <span class="n">car</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">requires</span> <span class="o">!</span><span class="n">Convertible</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Convertible</span> <span class="k">auto</span> <span class="n">cabrio</span> <span class="o">=</span> <span class="n">AwesomeCabrio</span><span class="p">{};</span>
  <span class="c1">//Coupe auto notACoupe = AwesomeCabrio{}; // nested requirement '! Convertible&lt;C&gt;' is not satisfied</span>
  <span class="n">Coupe</span> <span class="k">auto</span> <span class="n">coupe</span> <span class="o">=</span> <span class="n">CoolCoupe</span><span class="p">{};</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Let’s have a look at the concept <code class="language-plaintext highlighter-rouge">Coupe</code>. First, we make sure that only types satisfying the <code class="language-plaintext highlighter-rouge">Car</code> concept are accepted. Then we introduce a nested concept that requires that our template type is not a <code class="language-plaintext highlighter-rouge">Convertible</code>.</p><p>It’s true that we don’t <em>need</em> the nested constraint, we could express ourselves without it:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">C</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">Coupe</span> <span class="o">=</span> <span class="n">Car</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">Convertible</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
</pre></table></code></div></div><p>Nevertheless, we saw the syntax in a working example.</p><p>Nested requires clauses can be used more effectively with local parameters that are listed in the outer <code class="language-plaintext highlighter-rouge">requires</code> scope, like in the next example with <code class="language-plaintext highlighter-rouge">C clonable</code>:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="k">struct</span> <span class="nc">Droid</span> <span class="p">{</span>
  <span class="n">Droid</span> <span class="n">clone</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">Droid</span><span class="p">{};</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nc">DroidV2</span> <span class="p">{</span>
  <span class="n">Droid</span> <span class="n">clones</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">Droid</span><span class="p">{};</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">C</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">Clonable</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">(</span><span class="n">C</span> <span class="n">clonable</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">clonable</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
    <span class="k">requires</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="n">C</span><span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">clonable</span><span class="p">.</span><span class="n">clone</span><span class="p">())</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>


<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Clonable</span> <span class="k">auto</span> <span class="n">c</span> <span class="o">=</span> <span class="n">Droid</span><span class="p">{};</span>
  <span class="c1">// Clonable auto c2 = DroidV2{}; // nested requirement 'same_as&lt;C, decltype (clonable.clone())&gt;' is not satisfied</span>
<span class="p">}</span>
</pre></table></code></div></div><p>In this example, we have two droid types, <code class="language-plaintext highlighter-rouge">Droid</code> and <code class="language-plaintext highlighter-rouge">DroidV2</code>. We expect that droids should be clonable meaning that each type should have a clone method that returns another droid of the same type. With <code class="language-plaintext highlighter-rouge">DroidV2</code> we made a mistake and it still returns <code class="language-plaintext highlighter-rouge">Droid</code>.</p><p>Can we write a concept that catches this error?</p><p>We can, in fact as probably you noticed, we already did. In the concept <code class="language-plaintext highlighter-rouge">Clonable</code> we work with a <code class="language-plaintext highlighter-rouge">C cloneable</code> local parameter. With the nested requirement <code class="language-plaintext highlighter-rouge">requires std::same_as&lt;C, decltype(clonable.clone())&gt;</code> we express that the clone method should return the same type as the parameters’.</p><p>You might argue that there is another way to express this, without the nested clause and you’d be right:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">C</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">Clonable</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">(</span><span class="n">C</span> <span class="n">clonable</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">{</span> <span class="n">clonable</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>For a more complex example, I’d recommend you to check the implementation of <code class="language-plaintext highlighter-rouge">SemiRegular</code> concepts on <a href="https://en.cppreference.com/w/cpp/language/constraints">C++ Reference</a>.</p><p>To incorporate one of the requirements of <code class="language-plaintext highlighter-rouge">Semiregular</code> to our <code class="language-plaintext highlighter-rouge">Clonable</code> concept, we could write this:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="nc">C</span><span class="p">&gt;</span>
<span class="k">concept</span> <span class="n">Clonable</span> <span class="o">=</span> <span class="k">requires</span> <span class="p">(</span><span class="n">C</span> <span class="n">clonable</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">{</span> <span class="n">clonable</span><span class="p">.</span><span class="n">clone</span><span class="p">()</span> <span class="p">}</span> <span class="o">-&gt;</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
    <span class="k">requires</span> <span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="n">C</span><span class="o">*</span><span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="o">&amp;</span><span class="n">clonable</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>This additional line makes sure that the address of operator (<code class="language-plaintext highlighter-rouge">&amp;</code>) returns the same type for the <code class="language-plaintext highlighter-rouge">cloneable</code> parameter as <code class="language-plaintext highlighter-rouge">C*</code> is.</p><p>I agree, it doesn’t make much sense in this context (it does for <code class="language-plaintext highlighter-rouge">SemiRegular</code>), but it’s finally an example that is not easier to express without a nested requirement than with.</p><p>In the next post, we’ll see how to use a nested requirement when even the enclosing concept is unnamed.</p><h2 id="conclusion">Conclusion</h2><p>Today we continued and finished discussing what building blocks are available for us to write our own concepts. We saw how to make constraints on function return types, how to use type requirements on inner types, template aliases and specialisations and finally we saw that it’s possible to nest requirements, even though often there are easier ways to express ourselves.</p><p>Next time, we’ll continue with <a href="https://www.sandordargo.com/blog/2021/03/24/concepts-in-real-life">some real life examples</a> of how concepts can make our projects easier to understand. Stay tuned!</p><p><strong>If you want to learn more details about <em>C++ concepts</em>, <a href="https://leanpub.com/cppconcepts">check out my book on Leanpub</a>!</strong></p><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a> <a href="/tags/concepts/" class="post-tag no-text-decoration" >concepts</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a><div class="share-wrapper"> <a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How to write your own C++ concepts? Part II. - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2021/03/17/write-your-own-cpp-concepts-part-ii" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How to write your own C++ concepts? Part II. - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2021/03/17/write-your-own-cpp-concepts-part-ii" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=How to write your own C++ concepts? Part II. - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2021/03/17/write-your-own-cpp-concepts-part-ii" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=How to write your own C++ concepts? Part II. - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2021/03/17/write-your-own-cpp-concepts-part-ii" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2026/01/21/clocks-part-8-cpp20-timezones">Time in C++: C++20 Brought Us Time Zones</a><li><a href="/blog/2019/04/10/lesson-of-a-booking-dont-trust-the-system">Lesson of a booking: Don't trust the system!</a><li><a href="/blog/2020/07/22/always-catch-exceptions-by-reference">Why should we always catch exceptions by reference?</a><li><a href="/blog/2020/11/28/emergent-design">Emergent Design: The Evolutionary Nature of Professional Software Development by Scott Bain</a><li><a href="/blog/2021/10/06/airy-code-reviews">Bring some fresh AIR and write effective code review comments</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self-improvement</a> <a class="post-tag" href="/tags/management/">management</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2022/04/13/first-company-project-experience-with-cpp20"><div class="card-body"> <span class="timeago small" > Apr 13, 2022 <i class="unloaded">2022-04-13T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>My first work experience with C++20</h3><div class="text-muted small"><p> I joined a new team recently. We have our own internal microservices as well as libraries. While for microservices we support one main branch, for libraries we do have to support at least three, in...</p></div></div></a></div><div class="card"> <a href="/blog/2024/12/04/crtp-vs-concepts"><div class="card-body"> <span class="timeago small" > Dec 4, 2024 <i class="unloaded">2024-12-04T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Replace CRTP with concepts?</h3><div class="text-muted small"><p> In my Meeting C++ 2024 trip report, among my favourite ideas I mentioned Klaus Iglberger’s talk where he mentioned the possibility of replacing the curiously returning template pattern with the hel...</p></div></div></a></div><div class="card"> <a href="/blog/2021/02/10/cpp-concepts-motivations"><div class="card-body"> <span class="timeago small" > Feb 10, 2021 <i class="unloaded">2021-02-10T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The concept behind C++ concepts</h3><div class="text-muted small"><p> The idea of concepts is one of the major new features added to C++20. Concepts are an extension for templates. They can be used to perform compile-time validation of template arguments through bool...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2021/03/13/the-seniority-trap-you-have-to-ask-for-it" class="btn btn-outline-primary" prompt="Older"><p>You have to ask for it!</p></a> <a href="/blog/2021/03/20/skin-in-the-game-by-nassim-taleb" class="btn btn-outline-primary" prompt="Newer"><p>Skin in the Game: Hidden Asymmetries in Daily Life by Nassim Taleb</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//sandordargo-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'How to write your own C++ concepts? Part II.'; this.page.url = 'https://www.sandordargo.com/blog/2021/03/17/write-your-own-cpp-concepts-part-ii'; this.page.identifier = '/blog/2021/03/17/write-your-own-cpp-concepts-part-ii'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><div id="amzn-assoc-ad-be5a767b-3346-40aa-bc00-2eff0ce33d2b"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=be5a767b-3346-40aa-bc00-2eff0ce33d2b"></script> <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us16.list-manage.com","uuid":"b073dbd5c29322302f59a8cd8","lid":"d26240427e"}) })</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://twitter.com/SandorDargo">Sandor Dargo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self improvement</a> <a class="post-tag" href="/tags/management/">management</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sandordargo.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
