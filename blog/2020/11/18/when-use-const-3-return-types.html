<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="When to use const in C++? Part III: return types" /><meta property="og:locale" content="en_US" /><meta name="description" content="Just make everything const that you can! That’s the bare minimum you could do for your compiler! This is a piece of advice, many senior developers tend to repeat to juniors, while so often even the preaching ones - we - fail to follow this rule." /><meta property="og:description" content="Just make everything const that you can! That’s the bare minimum you could do for your compiler! This is a piece of advice, many senior developers tend to repeat to juniors, while so often even the preaching ones - we - fail to follow this rule." /><link rel="canonical" href="https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types" /><meta property="og:url" content="https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types" /><meta property="og:site_name" content="Sandor Dargo’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-18T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="When to use const in C++? Part III: return types" /><meta name="twitter:site" content="@SandorDargo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-26T07:01:23+01:00","datePublished":"2020-11-18T00:00:00+01:00","description":"Just make everything const that you can! That’s the bare minimum you could do for your compiler! This is a piece of advice, many senior developers tend to repeat to juniors, while so often even the preaching ones - we - fail to follow this rule.","headline":"When to use const in C++? Part III: return types","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types"},"url":"https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types"}</script><title>When to use const in C++? Part III: return types | Sandor Dargo's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-89625019-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-89625019-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/SANDOR_DARGO_ROUND.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sandor Dargo's Blog</a></div><div class="site-subtitle font-italic">On C++, software development and books</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/dailycpp/" class="nav-link"> <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>DAILY C++</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HI...</span> </a></ul><ul class="w-100"><li class="nav-item"> <a href="https://www.patreon.com/sandordargo" class="nav-link"> <img src="https://c5.patreon.com/external/logo/become_a_patron_button.png"></a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sandordargo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/SandorDargo" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sandor.dargo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Blog </a> </span> <span> <a href="/2020"> 2020 </a> </span> <span> <a href="/11"> 11 </a> </span> <span> <a href="/18"> 18 </a> </span> <span>When to use const in C++? Part III: return types</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>When to use const in C++? Part III: return types</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sandor Dargo </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Nov 18, 2020, 12:00 AM +0100" prep="on" > Nov 18, 2020 <i class="unloaded">2020-11-18T00:00:00+01:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Dec 26, 2024, 7:01 AM +0100" prefix="Updated " > Dec 26, 2024 <i class="unloaded">2024-12-26T07:01:23+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1383 words">7 min</span></div></div><div class="post-content"><p><em>Just make everything <code class="language-plaintext highlighter-rouge">const</code> that you can! That’s the bare minimum you could do for your compiler!</em></p><p>This is a piece of advice, many <em>senior</em> developers tend to repeat to juniors, while so often even the preaching ones - we - fail to follow this rule.</p><p>In this series of articles, we discuss about:</p><ul><li><a href="https://www.sandordargo.com/blog/2020/11/04/when-use-const-1-functions-local-variables"><code class="language-plaintext highlighter-rouge">const</code> functions</a><li><a href="https://www.sandordargo.com/blog/2020/11/04/when-use-const-1-functions-local-variables"><code class="language-plaintext highlighter-rouge">const</code> local variables</a><li><a href="https://www.sandordargo.com/blog/2020/11/11/when-use-const-2-member-variables"><code class="language-plaintext highlighter-rouge">const</code> member variables</a><li><a href="https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types"><code class="language-plaintext highlighter-rouge">const</code> return types</a><li><a href="https://www.sandordargo.com/blog/2020/11/25/when-use-const-4-parameters"><code class="language-plaintext highlighter-rouge">const</code> parameters</a></ul><p>In the last episodes, we covered the first three topics, <code class="language-plaintext highlighter-rouge">const</code> functions and <code class="language-plaintext highlighter-rouge">const</code> local variables, then <code class="language-plaintext highlighter-rouge">const</code> member variables and today we are covering return types.</p><p>What kind of variables can a function return? It can return values, references and pointers. And all of these can be const. Let’s have a look at each of them.</p><h2 id="returning-const-objects-by-value">Returning const objects by value</h2><p>If you’re really enthusiastic about turning everything into const and that’s your first time to do so, you might start converting signatures like <code class="language-plaintext highlighter-rouge">std::string getName() const</code> into <code class="language-plaintext highlighter-rouge">const std::string getName() const</code>. The only problem is that most probably it won’t make so much sense.</p><p>Why is that?</p><p>Putting <code class="language-plaintext highlighter-rouge">const</code> somewhere shows the reader (and the compiler of course) that something should <strong>not</strong> be modified. When we return something by value it means that a copy will be made for the caller. Okay, you might have heard about <a href="https://en.cppreference.com/w/cpp/language/copy_elision">copy elision</a> and its special form, return value optimization (RVO), but essentially we are still on the same page. The caller gets his own copy.</p><p>Does it make sense to make that own copy <code class="language-plaintext highlighter-rouge">const</code>?</p><p>Imagine that you buy a house but you cannot modify it? While there can be special cases, in general, you want your house to be your castle. Similarly, you want your copy to really be your object and you want to be able to do with it just whatever as an owner of it.</p><p>It doesn’t make sense and it’s misleading to return by value a const object.</p><p>Not just misleading, but probably even hurting you.</p><p>Even hurting? How can it be?</p><p>Let’s say you have this code:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">SgWithMove</span><span class="p">{</span><span class="cm">/**/</span><span class="p">};</span>

<span class="n">SgWithMove</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="n">SgWithMove</span> <span class="n">o</span><span class="p">;</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">foo</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>By using a debugger or by adding some logging to your special functions, you can see that RVO was perfectly applied and there was a move operation taking place when <code class="language-plaintext highlighter-rouge">foo()</code>s return value was assigned to <code class="language-plaintext highlighter-rouge">o</code>.</p><p>Now let’s add that infamous <code class="language-plaintext highlighter-rouge">const</code> to the return type.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">SgWithMove</span><span class="p">{</span><span class="cm">/**/</span><span class="p">};</span>

<span class="n">SgWithMove</span> <span class="nf">foo</span><span class="p">()</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">}</span>
<span class="k">const</span> <span class="n">SgWithMove</span> <span class="nf">bar</span><span class="p">()</span> <span class="p">{</span><span class="cm">/**/</span><span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
<span class="n">SgWithMove</span> <span class="n">o</span><span class="p">;</span>
<span class="n">o</span> <span class="o">=</span> <span class="n">bar</span><span class="p">();</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Following up with the debugger we can see that we didn’t benefit from a move, but actually, we made a copy.</p><p>We are returning a <code class="language-plaintext highlighter-rouge">const SgWithMove</code> and that is something we cannot pass as <code class="language-plaintext highlighter-rouge">SgWithMove&amp;&amp;</code> as it would discard the const qualifier. (A move would alter the object being moved) Instead, the copy assignment (<code class="language-plaintext highlighter-rouge">const SgWithMove&amp;</code>) is called and we just made another copy.</p><p><em>Please note that there are important books advocating for returning user-defined types by const value. They were right in their own age, but since then C++ went through a lot of changes and this piece of advice became obsolete.</em></p><h2 id="returning-const-references">Returning const references</h2><p>What about returning const references? Sometimes we can see this from very enthusiastic, but - hopefully - not so experienced developers that they return const references, just to be symmetric with the well-known rule of taking const reference arguments for objects.</p><p>So what is the problem?</p><p>Maybe nothing, maybe you’ll have a <a href="https://en.wikipedia.org/wiki/Dangling_pointer">dangling reference</a>. The problem is with returning const references is that the returned object has to outlive the caller. Or at least it has to live as long.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kt">void</span> <span class="nf">f</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">MyObject</span> <span class="n">o</span><span class="p">;</span>
  <span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">aRef</span> <span class="o">=</span> <span class="n">o</span><span class="p">.</span><span class="n">getSomethingConstRef</span><span class="p">();</span>
  <span class="n">aRef</span><span class="p">.</span><span class="n">doSomething</span><span class="p">();</span> <span class="c1">// will this work?</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Will that call work? It depends. If <code class="language-plaintext highlighter-rouge">MyObject::getSomethingConstRef()</code> returns a const reference of a local variable it will not work. It is because that local variable gets destroyed immediately once we get out of the scope of the function.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">MyObject</span><span class="o">::</span><span class="n">getSomethingConstRef</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">T</span> <span class="n">ret</span><span class="p">;</span>
  <span class="c1">// ...</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span> <span class="c1">// ret gets destroyed right after, the returned reference points at its ashes</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This is what is called a dangling reference.</p><p>On the other hand, if we return a reference to a member of <code class="language-plaintext highlighter-rouge">MyObject</code>, there is no problem in our above example.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">MyObject</span> 
<span class="p">{</span> 
<span class="nl">public:</span>
  <span class="c1">// ...</span>
  <span class="k">const</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">getSomethingConstRef</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">m_t</span><span class="p">;</span> <span class="c1">// m_t lives as long as our MyObject instance is alive</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">T</span> <span class="n">m_t</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><p>It’s worth to note that outside of <code class="language-plaintext highlighter-rouge">f()</code> we wouldn’t be able to use <code class="language-plaintext highlighter-rouge">aRef</code> as the instance of <code class="language-plaintext highlighter-rouge">MyObject</code> gets destroyed at the end of the function <code class="language-plaintext highlighter-rouge">f()</code>.</p><p>So shall we return const references?</p><p>As so often the answer is <em>it depends</em>. So definitely not automatically and by habit. We should return constant references only when are sure that the referenced object will be still available by the time we want to reference it.</p><p>At the same time:</p><p><strong>Never return locally initialized variables by reference!</strong></p><h2 id="return-const-pointers">Return const pointers</h2><p>Pointers are similar to references in a sense that the pointed object must be alive at least as long as the caller wants to use it. You can return the address of a member variable if you know that the object will not get destroyed as long as the caller wants the returned address. What is important to emphasize once again is that we can never return a pointer to a locally initialized variable.</p><p>But even that is not so self-evident. Let’s step back a little bit.</p><p>What do we return when we return a pointer?</p><p>We return a memory address. The address can be of anything. Technically it can be a random place, it can be a null pointer or it can be the address of an object. (OK, a random place can be the address of a valid object, but it can be simply garbage. After all, it’s random.)</p><p>Even if we talk about an object that was declared in the scope of the enclosing function, that object could have been declared either on the stack or on the heap.</p><p>If it was declared on the stack (no <code class="language-plaintext highlighter-rouge">new</code>), it means that it will be automatically destroyed when we leave the enclosing function.</p><p>If the object was created on the heap (with <code class="language-plaintext highlighter-rouge">new</code>), that’s not a problem anymore, the object will be alive, but you have to manage its lifetime. Except if you return a smart pointer, but that’s beyond the scope of this article.</p><p>So we have to make sure that we don’t return a dangling pointer, but after that, does it make sense to return a const pointer?</p><ul><li><code class="language-plaintext highlighter-rouge">int * const func () const</code></ul><p>The function is constant, and the returned pointer is constant but the data we point at can be modified. However, I see no point in returning a const pointer because the ultimate function call will be an rvalue, and rvalues of non-class type cannot be const, meaning that const will be ignored anyway</p><ul><li><code class="language-plaintext highlighter-rouge">const int* func () const</code></ul><p>This is a useful thing. The pointed data cannot be modified.</p><ul><li><code class="language-plaintext highlighter-rouge">const int * const func() const</code></ul><p>Semantically this is almost the same as the previous option. The data we point at cannot be modified. On the other hand, the constness of the pointer itself will be ignored.</p><p>So does it make sense to return a <code class="language-plaintext highlighter-rouge">const</code> pointer? It depends on what is <code class="language-plaintext highlighter-rouge">const</code>. If the constness refers to the pointed object, yes it does. If you try to make the pointer <code class="language-plaintext highlighter-rouge">itself</code> const, it doesn’t make sense as it will be ignored.</p><h2 id="conclusion">Conclusion</h2><p>Today, we learned about <code class="language-plaintext highlighter-rouge">const</code> return types. We saw that simply returning <code class="language-plaintext highlighter-rouge">const</code> values don’t make much sense and - counterintuitively - it might hurt the performance. Returning a <code class="language-plaintext highlighter-rouge">const</code> reference is even dangerous and might lead to segmentation faults.</p><p>Const pointers are bit more varied topics, you don’t face many dangers but constness there can be ignored.</p><p>Stay tuned, next time we’ll learn about <code class="language-plaintext highlighter-rouge">const</code> parameters.</p><p><strong>If you want to learn more details about <em>How to use const in C++</em>, <a href="https://leanpub.com/cppconst">check out my book on Leanpub</a>!</strong></p><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a> <a href="/tags/tutorial/" class="post-tag no-text-decoration" >tutorial</a> <a href="/tags/const/" class="post-tag no-text-decoration" >const</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a><div class="share-wrapper"> <a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=When to use const in C++? Part III: return types - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=When to use const in C++? Part III: return types - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=When to use const in C++? Part III: return types - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=When to use const in C++? Part III: return types - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2025/10/22/trip-report-budapest-cpp">Trip report: Budapest C++ - Breaking & Building C++</a><li><a href="/blog/2025/10/01/cpp26-optional-of-reference">C++26: std::optional&lt;T&amp;&gt;</a><li><a href="/blog/2025/09/24/trip-report-cppcon-2025">Trip report: CppCon 2025</a><li><a href="/blog/2025/07/23/format-your-own-type-part-1">Format your own type (Part 1)</a><li><a href="/blog/2025/07/02/cpponsea-trip-report">Trip report: C++ On Sea 2025</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self-improvement</a> <a class="post-tag" href="/tags/management/">management</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2020/11/04/when-use-const-1-functions-local-variables"><div class="card-body"> <span class="timeago small" > Nov 4, 2020 <i class="unloaded">2020-11-04T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>When to use const in C++? Part I: functions and local variables</h3><div class="text-muted small"><p> Just make everything const that you can! That’s the bare minimum you could do for your compiler! This is a piece of advice, many senior developers tend to repeat to juniors, while so often even th...</p></div></div></a></div><div class="card"> <a href="/blog/2020/11/11/when-use-const-2-member-variables"><div class="card-body"> <span class="timeago small" > Nov 11, 2020 <i class="unloaded">2020-11-11T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>When to use const in C++? Part II: member variables</h3><div class="text-muted small"><p> Just make everything const that you can! That’s the bare minimum you could do for your compiler! This is a piece of advice, many senior developers tend to repeat to juniors, while so often even th...</p></div></div></a></div><div class="card"> <a href="/blog/2020/11/25/when-use-const-4-parameters"><div class="card-body"> <span class="timeago small" > Nov 25, 2020 <i class="unloaded">2020-11-25T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>When to use const in C++? Part IV: parameters</h3><div class="text-muted small"><p> Just make everything const that you can! That’s the bare minimum you could do for your compiler! This is a piece of advice, many senior developers tend to repeat to juniors, while so often even th...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2020/11/15/what-kind-of-a-job-you-looking-for" class="btn btn-outline-primary" prompt="Older"><p>What do you want from a job, that is the question</p></a> <a href="/blog/2020/11/21/12-rules-for-life" class="btn btn-outline-primary" prompt="Newer"><p>12 Rules for Life - An Antidote to Chaos by Jordan Peterson</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//sandordargo-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'When to use const in C++? Part III: return types'; this.page.url = 'https://www.sandordargo.com/blog/2020/11/18/when-use-const-3-return-types'; this.page.identifier = '/blog/2020/11/18/when-use-const-3-return-types'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><div id="amzn-assoc-ad-be5a767b-3346-40aa-bc00-2eff0ce33d2b"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=be5a767b-3346-40aa-bc00-2eff0ce33d2b"></script> <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us16.list-manage.com","uuid":"b073dbd5c29322302f59a8cd8","lid":"d26240427e"}) })</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/SandorDargo">Sandor Dargo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self improvement</a> <a class="post-tag" href="/tags/management/">management</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sandordargo.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
