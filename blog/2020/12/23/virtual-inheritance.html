<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="What is virtual inheritance in C++ and when should you use it?" /><meta property="og:locale" content="en_US" /><meta name="description" content="When we start coding in an object-oriented programming language we often think that it’s about building nice inheritance hierarchies. So we do. A bit later we learn that we should rather use composition over inheritance. So we do. But we still need inheritance, and from time to time we run into problems where it seems to be the only way. At those times, we might learn about some more specialized forms of inheritance. In C++, this might mean private inheritance or virtual inheritance. Today we speak about the latter." /><meta property="og:description" content="When we start coding in an object-oriented programming language we often think that it’s about building nice inheritance hierarchies. So we do. A bit later we learn that we should rather use composition over inheritance. So we do. But we still need inheritance, and from time to time we run into problems where it seems to be the only way. At those times, we might learn about some more specialized forms of inheritance. In C++, this might mean private inheritance or virtual inheritance. Today we speak about the latter." /><link rel="canonical" href="https://www.sandordargo.com/blog/2020/12/23/virtual-inheritance" /><meta property="og:url" content="https://www.sandordargo.com/blog/2020/12/23/virtual-inheritance" /><meta property="og:site_name" content="Sandor Dargo’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-12-23T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="What is virtual inheritance in C++ and when should you use it?" /><meta name="twitter:site" content="@SandorDargo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-01-03T06:34:57+01:00","datePublished":"2020-12-23T00:00:00+01:00","description":"When we start coding in an object-oriented programming language we often think that it’s about building nice inheritance hierarchies. So we do. A bit later we learn that we should rather use composition over inheritance. So we do. But we still need inheritance, and from time to time we run into problems where it seems to be the only way. At those times, we might learn about some more specialized forms of inheritance. In C++, this might mean private inheritance or virtual inheritance. Today we speak about the latter.","headline":"What is virtual inheritance in C++ and when should you use it?","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sandordargo.com/blog/2020/12/23/virtual-inheritance"},"url":"https://www.sandordargo.com/blog/2020/12/23/virtual-inheritance"}</script><title>What is virtual inheritance in C++ and when should you use it? | Sandor Dargo's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-89625019-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-89625019-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/SANDOR_DARGO_ROUND.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sandor Dargo's Blog</a></div><div class="site-subtitle font-italic">On C++, software development and books</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/dailycpp/" class="nav-link"> <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>DAILY C++</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HI...</span> </a></ul><ul class="w-100"><li class="nav-item"> <a href="https://www.patreon.com/sandordargo" class="nav-link"> <img src="https://c5.patreon.com/external/logo/become_a_patron_button.png"></a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sandordargo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/SandorDargo" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sandor.dargo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Blog </a> </span> <span> <a href="/2020"> 2020 </a> </span> <span> <a href="/12"> 12 </a> </span> <span> <a href="/23"> 23 </a> </span> <span>What is virtual inheritance in C++ and when should you use it?</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>What is virtual inheritance in C++ and when should you use it?</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sandor Dargo </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Dec 23, 2020, 12:00 AM +0100" prep="on" > Dec 23, 2020 <i class="unloaded">2020-12-23T00:00:00+01:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Jan 3, 2025, 6:34 AM +0100" prefix="Updated " > Jan 3 <i class="unloaded">2025-01-03T06:34:57+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1304 words">7 min</span></div></div><div class="post-content"><p>When we start coding in an object-oriented programming language we often think that it’s about building nice inheritance hierarchies. So we do. A bit later we learn that we should rather use composition over inheritance. So we do. But we still need inheritance, and from time to time we run into problems where it seems to be the only way. At those times, we might learn about some more specialized forms of inheritance. In C++, this might mean <a href="">private inheritance</a> or <em>virtual inheritance</em>. Today we speak about the latter.</p><h2 id="what-is-virtual-inheritance">What is virtual inheritance?</h2><h3 id="the-diamond-problem">The diamond problem</h3><p><em>Virtual inheritance</em> is a C++ technique that ensures that only one copy of a base class’s member variables are inherited by second-level derivatives (a.k.a. grandchild derived classes). Without virtual inheritance, if two classes B and C inherit from class A, and class D inherits from both B and C, then D will contain two copies of A’s member variables: one via B, and one via C. These will be accessible independently, using scope resolution.</p><p>Instead, if classes B and C inherit virtually from class A, then objects of class D will contain only one set of the member variables from class A.</p><p>As you probably guessed, this technique is useful when you have to deal with multiple inheritance and it’s a way to solve the infamous diamond inheritance.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/diamon-inheritance.png" alt="The Diamond Inheritance Problem" /></p><h3 id="multiple-base-class-instances">Multiple base class instances</h3><p>In practice, virtual base classes are most suitable when the classes that derive from the virtual base, and especially the virtual base itself, are pure abstract classes. This means the classes above the “join class” (the one in the bottom) have very little if any data.</p><p>Consider the following class hierarchy to represent the diamond problem, though not with pure abstracts.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">Person</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">Person</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">speak</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Student</span><span class="o">:</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">learn</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Worker</span><span class="o">:</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">work</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="c1">// A teaching assistant is both a worker and a student</span>
<span class="k">struct</span> <span class="nc">TeachingAssistant</span><span class="o">:</span> <span class="n">Student</span><span class="p">,</span> <span class="n">Worker</span> <span class="p">{};</span>

<span class="n">TeachingAssistant</span> <span class="n">ta</span><span class="p">;</span>
</pre></table></code></div></div><p>As we said above, a call to <code class="language-plaintext highlighter-rouge">aTeachingAssistant.speak()</code> is ambiguous because there are two <code class="language-plaintext highlighter-rouge">Person</code> (indirect) base classes in <code class="language-plaintext highlighter-rouge">TeachingAssistant</code>, so any <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> object has two different <code class="language-plaintext highlighter-rouge">Person</code> base class subobjects.</p><p>An attempt to directly bind a reference to the <code class="language-plaintext highlighter-rouge">Person</code> subobject of a <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> object would fail, since the binding is inherently ambiguous:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">TeachingAssistant</span> <span class="n">ta</span><span class="p">;</span>
<span class="n">Person</span><span class="o">&amp;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">ta</span><span class="p">;</span>  <span class="c1">// error: which Person subobject should a TeachingAssistant cast into, </span>
                <span class="c1">// a Student::Person or a Worker::Person?</span>
</pre></table></code></div></div><p>To disambiguate, we would need to explicitly convert <code class="language-plaintext highlighter-rouge">ta</code> to any of the two base class subobjects:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="n">TeachingAssistant</span> <span class="n">ta</span><span class="p">;</span>
<span class="n">Person</span><span class="o">&amp;</span> <span class="n">student</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Student</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">ta</span><span class="p">);</span> 
<span class="n">Person</span><span class="o">&amp;</span> <span class="n">worker</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Worker</span><span class="o">&amp;&gt;</span><span class="p">(</span><span class="n">ta</span><span class="p">);</span>
</pre></table></code></div></div><p>In order to call <code class="language-plaintext highlighter-rouge">speak()</code>, the same disambiguation, or explicit qualification is needed: <code class="language-plaintext highlighter-rouge">static_cast&lt;Student&amp;&gt;(ta).speak()</code> or <code class="language-plaintext highlighter-rouge">static_cast&lt;Worker&amp;&gt;(ta).speak()</code> or alternatively <code class="language-plaintext highlighter-rouge">ta.Student::speak()</code> and <code class="language-plaintext highlighter-rouge">ta.Worker::speak()</code>. Explicit qualification not only uses an easier, uniform syntax for both pointers and objects but also allows for static dispatch, so it would arguably be the preferable way to do it.</p><p>In this case, the double inheritance of <code class="language-plaintext highlighter-rouge">Person</code> is probably unwanted, as we want to model that the relation between <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> and a <code class="language-plaintext highlighter-rouge">Person</code> exists only once. The fact that a <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> is a <code class="language-plaintext highlighter-rouge">Student</code> and is a <code class="language-plaintext highlighter-rouge">Worker</code> at the same time does not imply that a <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> is a <code class="language-plaintext highlighter-rouge">Person</code> twice (unless the <code class="language-plaintext highlighter-rouge">TA</code> suffers from schizophrenia): a <code class="language-plaintext highlighter-rouge">Person</code> base class corresponds to a contract that <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> implements (the “is a” relationship above really means “implements the requirements of”), and a <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> only implements the <code class="language-plaintext highlighter-rouge">Person</code> contract once.</p><h3 id="there-should-be-only-one-behaviour">There should be only one behaviour</h3><p>The real-world meaning of “exists only once” is that a <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> should have only one way of implementing <code class="language-plaintext highlighter-rouge">speak</code>, not two different ways.</p><p>In our degenerate case, <code class="language-plaintext highlighter-rouge">Person::speak()</code> is not overridden in either <code class="language-plaintext highlighter-rouge">Student</code> or <code class="language-plaintext highlighter-rouge">Worker</code>, but that could be different and then we would <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> would have multiple implementations of the <code class="language-plaintext highlighter-rouge">speak()</code> method.</p><p>If we introduce <code class="language-plaintext highlighter-rouge">virtual</code> to our inheritance in the following way, our problems disappear:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="nc">Person</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="o">~</span><span class="n">Person</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">speak</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="c1">// Two classes virtually inheriting Person:</span>
<span class="k">struct</span> <span class="nc">Student</span><span class="o">:</span> <span class="k">virtual</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">learn</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="nc">Worker</span><span class="o">:</span> <span class="k">virtual</span> <span class="n">Person</span> <span class="p">{</span>
    <span class="k">virtual</span> <span class="kt">void</span> <span class="n">work</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">};</span>

<span class="c1">// A teaching assistant is still a student and the worker</span>
<span class="k">struct</span> <span class="nc">TeachingAssistant</span><span class="o">:</span> <span class="n">Student</span><span class="p">,</span> <span class="n">Worker</span> <span class="p">{};</span>
</pre></table></code></div></div><p>Now we can easily call <code class="language-plaintext highlighter-rouge">speak()</code>.</p><p>The <code class="language-plaintext highlighter-rouge">Person</code> portion of <code class="language-plaintext highlighter-rouge">TeachingAssistant::Worker</code> is now the same <code class="language-plaintext highlighter-rouge">Person</code> instance as the one used by <code class="language-plaintext highlighter-rouge">TeachingAssistant::Student</code>, which is to say that a <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> has only one - shared - <code class="language-plaintext highlighter-rouge">Person</code> instance in its representation and so a call to <code class="language-plaintext highlighter-rouge">TeachingAssistant::speak</code> is unambiguous. Additionally, a direct cast from <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> to <code class="language-plaintext highlighter-rouge">Person</code> is also unambiguous, now that there exists only one <code class="language-plaintext highlighter-rouge">Person</code> instance which <code class="language-plaintext highlighter-rouge">TeachingAssistant</code> could be converted to.</p><p>This can be done through <code class="language-plaintext highlighter-rouge">vtable</code> pointers. Without going into details, the object size increases by two pointers, but there is only one <code class="language-plaintext highlighter-rouge">Person</code> object behind and no ambiguity.</p><p>You must use the <code class="language-plaintext highlighter-rouge">virtual</code> keyword in the middle level of the diamond. Using it in the bottom doesn’t help.</p><p>You can find more detail at the <a href="https://isocpp.org/wiki/faq/multiple-inheritance">Core Guidelines</a> and <a href="https://en.wikipedia.org/wiki/Virtual_inheritance">here</a>.</p><h2 id="should-we-always-use-virtual-inheritance-if-yes-why-if-not-why-not">Should we always use virtual inheritance? If yes, why? If not, why not?</h2><p>The answer is definitely no. The base of an idiomatic answer can be the most fundamental idea of C++: <strong>you only pay for what you use</strong>. And if you don’t need virtual inheritance, you should rather not pay for it.</p><p>Virtual inheritance is almost never needed. It addresses the diamond inheritance problem that we saw at the beginning of the article. It can only happen if you have multiple inheritance, otherwise, you cannot have this issue.</p><p>At the same time, it has some drawbacks.</p><h3 id="more-complex-dependencies">More complex dependencies</h3><p>Virtual inheritance causes troubles with object initialization and copying. Since it is the “most derived” class that is responsible for these operations, it has to be familiar with all the intimate details of the structure of base classes.</p><p>Due to this, a more complex dependency appears between the classes, which complicates the project structure and forces you to make some additional revisions in all those classes during refactoring. All this leads to new bugs and makes the code less readable and thus less maintainable.</p><h3 id="expensive-type-conversions">Expensive type conversions</h3><p><a href="https://isocpp.org/wiki/faq/multiple-inheritance#virtual-inheritance-casts">ISO C++ guidelines</a> also suggests that C-style downcasts cannot be used to cast a base class pointer to a derived one.</p><p>The problems can be solved by <code class="language-plaintext highlighter-rouge">dynamic_cast</code>, but it has its performance implications. Using too much <code class="language-plaintext highlighter-rouge">dynamic_cast</code> in your code can make a big hit, and it also means that your project’s architecture is probably very poor.</p><p>You can always implement what you need without multiple inheritance. There is no surprise in that. After all, the feature of virtual inheritance is not present in many other major languages, yet they are used for large and complex projects.</p><h2 id="conclusion">Conclusion</h2><p>Today, we discussed the diamond inheritance problem. We understood that when there are multiple paths between a base and a derived class, there are multiple base objects instantiated which is almost never desirable. C++ proposes virtual inheritance to solve this problem and letting such structures to live with only one instance of a base class.</p><p>Yet, as you should only pay for what you use, virtual inheritance should not be your default choice. Most projects can be implemented without such a language feature and if you can design your software without multiple inheritance, you don’t need to deal with its downsides.</p><p>Have you ever used multiple inheritance in your production code? If yes, what was the use-case?</p><h2 id="connect-deeper">Connect deeper</h2><p>If you found interesting this article, please <a href="http://eepurl.com/gvcv1j">subscribe to my newsletter</a> and let’s connect on <a href="https://twitter.com/SandorDargo">Twitter</a>!</p><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a> <a href="/tags/tutorial/" class="post-tag no-text-decoration" >tutorial</a> <a href="/tags/oop/" class="post-tag no-text-decoration" >oop</a> <a href="/tags/inheritance/" class="post-tag no-text-decoration" >inheritance</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a><div class="share-wrapper"> <a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=What is virtual inheritance in C++ and when should you use it? - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2020/12/23/virtual-inheritance" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=What is virtual inheritance in C++ and when should you use it? - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2020/12/23/virtual-inheritance" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=What is virtual inheritance in C++ and when should you use it? - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2020/12/23/virtual-inheritance" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=What is virtual inheritance in C++ and when should you use it? - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2020/12/23/virtual-inheritance" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2025/10/22/trip-report-budapest-cpp">Trip report: Budapest C++ - Breaking & Building C++</a><li><a href="/blog/2025/10/01/cpp26-optional-of-reference">C++26: std::optional&lt;T&amp;&gt;</a><li><a href="/blog/2025/09/24/trip-report-cppcon-2025">Trip report: CppCon 2025</a><li><a href="/blog/2025/07/23/format-your-own-type-part-1">Format your own type (Part 1)</a><li><a href="/blog/2025/07/02/cpponsea-trip-report">Trip report: C++ On Sea 2025</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self-improvement</a> <a class="post-tag" href="/tags/management/">management</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2021/01/27/virtual-functions-with-default-arguments"><div class="card-body"> <span class="timeago small" > Jan 27, 2021 <i class="unloaded">2021-01-27T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Can virtual functions have default arguments?</h3><div class="text-muted small"><p> Yes, they can, but you should not rely on them, as you might not get what you’d expect. If you wonder how this topic came up, the answer is static code analysis! We have been using static code a...</p></div></div></a></div><div class="card"> <a href="/blog/2020/01/08/default-member-initialization"><div class="card-body"> <span class="timeago small" > Jan 8, 2020 <i class="unloaded">2020-01-08T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Default Member Initializers in C++</h3><div class="text-muted small"><p> This topic came up recently during a coding dojo in our department, while we were working on the ugly trivia kata. We wanted to extract a struct, containing the player data. Later we wanted to turn...</p></div></div></a></div><div class="card"> <a href="/blog/2020/04/01/private-inheritanc-vs-composition"><div class="card-body"> <span class="timeago small" > Apr 1, 2020 <i class="unloaded">2020-04-01T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The quest of private inheritance in C++</h3><div class="text-muted small"><p> I love mentoring. It requires a huge quantity of humility, and if you possess it, it will bring you tremendous benefits on a human as well as on a technical level. A few weeks ago, I met with on...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2020/12/19/santas-christmas-wishlist" class="btn btn-outline-primary" prompt="Older"><p>Santa's Christmas Wishlist</p></a> <a href="/blog/2020/12/26/good-to-great-by-jim-collins" class="btn btn-outline-primary" prompt="Newer"><p>Good to Great: Why Some Companies Make the Leap...and Others Don't by Jim Collins</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//sandordargo-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'What is virtual inheritance in C++ and when should you use it?'; this.page.url = 'https://www.sandordargo.com/blog/2020/12/23/virtual-inheritance'; this.page.identifier = '/blog/2020/12/23/virtual-inheritance'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><div id="amzn-assoc-ad-be5a767b-3346-40aa-bc00-2eff0ce33d2b"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=be5a767b-3346-40aa-bc00-2eff0ce33d2b"></script> <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us16.list-manage.com","uuid":"b073dbd5c29322302f59a8cd8","lid":"d26240427e"}) })</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/SandorDargo">Sandor Dargo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self improvement</a> <a class="post-tag" href="/tags/management/">management</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sandordargo.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
