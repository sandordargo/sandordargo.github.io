<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Declaring a friendship to self" /><meta property="og:locale" content="en_US" /><meta name="description" content="Recently, I ran into some code where a class declared itself as a friend. I was quite surprised to see that and at a second glance, I realised that there were 2 characters difference in a relatively long class name. But my curiosity was already awakened. Are there situations when a class should include a friendship declaration to itself? First of all, if you declare a class friend of itself directly, the compiler might issue a warning. 1 2 3 class C { friend class C; // warning: class &#39;C&#39; is implicitly friends with itself }; Otherwise, I found two scenarios which I want to share with you. They are slightly different, you might consider cheating both, but these are the closest ones I found. Explicitly Enabling Template Specialization Access The cheating in the first example is that it uses templates. You’ll see friend class Wrapper in Wrapper, but you’ll see more. In fact, Wrapper is Wrapper&lt;T&gt;. Instantiate Wrapper with different types, and they turn out to be distinct, unrelated types. What if you want to have access from a Wrapper specialization to private elements of Wrapper&lt;U&gt;. Without declaring a friendship, it’s not going to work. Let’s see the code. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #include &lt;concepts&gt; #include &lt;iostream&gt; template &lt;typename T&gt; class Wrapper { private: int secret = 42; template &lt;typename U&gt; friend class Wrapper; // Friend itself to allow specializations access public: void showSecret() { std::cout &lt;&lt; &quot;Secret: &quot; &lt;&lt; secret &lt;&lt; std::endl; } }; template &lt;&gt; class Wrapper&lt;int&gt; { public: template &lt;typename T&gt; requires (!std::same_as&lt;T, int&gt;) void accessSecret(Wrapper&lt;T&gt;&amp; w) { // Thanks to the friend declaration, this specialization can access private members std::cout &lt;&lt; &quot;Accessing: &quot; &lt;&lt; w.secret &lt;&lt; std::endl; } }; int main () { auto w1 = Wrapper&lt;int&gt;(); auto w2 = Wrapper&lt;double&gt;(); w1.accessSecret(w2); } Notice that the Wrapper&lt;int&gt; specialization defines an accessSecret method which accepts any instantiation of a Wrapper class and tries to access a private member of Wrapper called secret. Remove the friendship and you’ll see that Wrapper&lt;int&gt; has no access to private elements of Wrapper&lt;double&gt;. Notice that we didn’t simply declare Wrapper as a friend, but we used a templated version template &lt;typename U&gt; friend class Wrapper. You can play around with the code on Godbolt. Declare the outer class as a friend Let’s talk about nested classes. An outer class doesn’t have access to the non-public members of an inner class, and an outer class has no access to the non-public members of an inner class. Though it would be strange to speak about declaring the inner class as a friend in this article, there is no way to qualify to inner class as self. But to declare Outer as a friend of Outer::Inner, that’s not too strong a bending of my self-made constraints. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #include &lt;iostream&gt; class Outer { public: class Inner { int secret = 42; friend class Outer; }; void revealSecret(const Inner&amp; inner) { std::cout &lt;&lt; &quot;Inner&#39;s secret is: &quot; &lt;&lt; inner.secret &lt;&lt; &#39;\n&#39;; } }; int main() { Outer::Inner innerObj; Outer outerObj; outerObj.revealSecret(innerObj); // Prints: Inner&#39;s secret is: 42 } I know this example is a bit simplistic. It’s also a bit difficult to imagine a real-life situation when an outer class needs access to non-public members of an inner class. But you can imagine situations where there is an inner class representing some sort of state and only the outer class should be able to manipulate the state, no one else. In such cases, declaring the outer class a friend of the inner class makes sense. Conclusion Today we discussed cases when a class declares itself as a friend. Well, not exactly, maybe. We saw template classes declaring other specializations as friends, and nested classes where inner classes declare their enclosing classes as friends. Have you ever had to use such a technique? Connect deeper If you liked this article, please hit on the like button, subscribe to my newsletter" /><meta property="og:description" content="Recently, I ran into some code where a class declared itself as a friend. I was quite surprised to see that and at a second glance, I realised that there were 2 characters difference in a relatively long class name. But my curiosity was already awakened. Are there situations when a class should include a friendship declaration to itself? First of all, if you declare a class friend of itself directly, the compiler might issue a warning. 1 2 3 class C { friend class C; // warning: class &#39;C&#39; is implicitly friends with itself }; Otherwise, I found two scenarios which I want to share with you. They are slightly different, you might consider cheating both, but these are the closest ones I found. Explicitly Enabling Template Specialization Access The cheating in the first example is that it uses templates. You’ll see friend class Wrapper in Wrapper, but you’ll see more. In fact, Wrapper is Wrapper&lt;T&gt;. Instantiate Wrapper with different types, and they turn out to be distinct, unrelated types. What if you want to have access from a Wrapper specialization to private elements of Wrapper&lt;U&gt;. Without declaring a friendship, it’s not going to work. Let’s see the code. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #include &lt;concepts&gt; #include &lt;iostream&gt; template &lt;typename T&gt; class Wrapper { private: int secret = 42; template &lt;typename U&gt; friend class Wrapper; // Friend itself to allow specializations access public: void showSecret() { std::cout &lt;&lt; &quot;Secret: &quot; &lt;&lt; secret &lt;&lt; std::endl; } }; template &lt;&gt; class Wrapper&lt;int&gt; { public: template &lt;typename T&gt; requires (!std::same_as&lt;T, int&gt;) void accessSecret(Wrapper&lt;T&gt;&amp; w) { // Thanks to the friend declaration, this specialization can access private members std::cout &lt;&lt; &quot;Accessing: &quot; &lt;&lt; w.secret &lt;&lt; std::endl; } }; int main () { auto w1 = Wrapper&lt;int&gt;(); auto w2 = Wrapper&lt;double&gt;(); w1.accessSecret(w2); } Notice that the Wrapper&lt;int&gt; specialization defines an accessSecret method which accepts any instantiation of a Wrapper class and tries to access a private member of Wrapper called secret. Remove the friendship and you’ll see that Wrapper&lt;int&gt; has no access to private elements of Wrapper&lt;double&gt;. Notice that we didn’t simply declare Wrapper as a friend, but we used a templated version template &lt;typename U&gt; friend class Wrapper. You can play around with the code on Godbolt. Declare the outer class as a friend Let’s talk about nested classes. An outer class doesn’t have access to the non-public members of an inner class, and an outer class has no access to the non-public members of an inner class. Though it would be strange to speak about declaring the inner class as a friend in this article, there is no way to qualify to inner class as self. But to declare Outer as a friend of Outer::Inner, that’s not too strong a bending of my self-made constraints. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #include &lt;iostream&gt; class Outer { public: class Inner { int secret = 42; friend class Outer; }; void revealSecret(const Inner&amp; inner) { std::cout &lt;&lt; &quot;Inner&#39;s secret is: &quot; &lt;&lt; inner.secret &lt;&lt; &#39;\n&#39;; } }; int main() { Outer::Inner innerObj; Outer outerObj; outerObj.revealSecret(innerObj); // Prints: Inner&#39;s secret is: 42 } I know this example is a bit simplistic. It’s also a bit difficult to imagine a real-life situation when an outer class needs access to non-public members of an inner class. But you can imagine situations where there is an inner class representing some sort of state and only the outer class should be able to manipulate the state, no one else. In such cases, declaring the outer class a friend of the inner class makes sense. Conclusion Today we discussed cases when a class declares itself as a friend. Well, not exactly, maybe. We saw template classes declaring other specializations as friends, and nested classes where inner classes declare their enclosing classes as friends. Have you ever had to use such a technique? Connect deeper If you liked this article, please hit on the like button, subscribe to my newsletter" /><link rel="canonical" href="https://www.sandordargo.com/blog/2025/05/14/friend-self" /><meta property="og:url" content="https://www.sandordargo.com/blog/2025/05/14/friend-self" /><meta property="og:site_name" content="Sandor Dargo’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-05-14T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Declaring a friendship to self" /><meta name="twitter:site" content="@SandorDargo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-05-14T00:00:00+02:00","datePublished":"2025-05-14T00:00:00+02:00","description":"Recently, I ran into some code where a class declared itself as a friend. I was quite surprised to see that and at a second glance, I realised that there were 2 characters difference in a relatively long class name. But my curiosity was already awakened. Are there situations when a class should include a friendship declaration to itself? First of all, if you declare a class friend of itself directly, the compiler might issue a warning. 1 2 3 class C { friend class C; // warning: class &#39;C&#39; is implicitly friends with itself }; Otherwise, I found two scenarios which I want to share with you. They are slightly different, you might consider cheating both, but these are the closest ones I found. Explicitly Enabling Template Specialization Access The cheating in the first example is that it uses templates. You’ll see friend class Wrapper in Wrapper, but you’ll see more. In fact, Wrapper is Wrapper&lt;T&gt;. Instantiate Wrapper with different types, and they turn out to be distinct, unrelated types. What if you want to have access from a Wrapper specialization to private elements of Wrapper&lt;U&gt;. Without declaring a friendship, it’s not going to work. Let’s see the code. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 #include &lt;concepts&gt; #include &lt;iostream&gt; template &lt;typename T&gt; class Wrapper { private: int secret = 42; template &lt;typename U&gt; friend class Wrapper; // Friend itself to allow specializations access public: void showSecret() { std::cout &lt;&lt; &quot;Secret: &quot; &lt;&lt; secret &lt;&lt; std::endl; } }; template &lt;&gt; class Wrapper&lt;int&gt; { public: template &lt;typename T&gt; requires (!std::same_as&lt;T, int&gt;) void accessSecret(Wrapper&lt;T&gt;&amp; w) { // Thanks to the friend declaration, this specialization can access private members std::cout &lt;&lt; &quot;Accessing: &quot; &lt;&lt; w.secret &lt;&lt; std::endl; } }; int main () { auto w1 = Wrapper&lt;int&gt;(); auto w2 = Wrapper&lt;double&gt;(); w1.accessSecret(w2); } Notice that the Wrapper&lt;int&gt; specialization defines an accessSecret method which accepts any instantiation of a Wrapper class and tries to access a private member of Wrapper called secret. Remove the friendship and you’ll see that Wrapper&lt;int&gt; has no access to private elements of Wrapper&lt;double&gt;. Notice that we didn’t simply declare Wrapper as a friend, but we used a templated version template &lt;typename U&gt; friend class Wrapper. You can play around with the code on Godbolt. Declare the outer class as a friend Let’s talk about nested classes. An outer class doesn’t have access to the non-public members of an inner class, and an outer class has no access to the non-public members of an inner class. Though it would be strange to speak about declaring the inner class as a friend in this article, there is no way to qualify to inner class as self. But to declare Outer as a friend of Outer::Inner, that’s not too strong a bending of my self-made constraints. 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 #include &lt;iostream&gt; class Outer { public: class Inner { int secret = 42; friend class Outer; }; void revealSecret(const Inner&amp; inner) { std::cout &lt;&lt; &quot;Inner&#39;s secret is: &quot; &lt;&lt; inner.secret &lt;&lt; &#39;\\n&#39;; } }; int main() { Outer::Inner innerObj; Outer outerObj; outerObj.revealSecret(innerObj); // Prints: Inner&#39;s secret is: 42 } I know this example is a bit simplistic. It’s also a bit difficult to imagine a real-life situation when an outer class needs access to non-public members of an inner class. But you can imagine situations where there is an inner class representing some sort of state and only the outer class should be able to manipulate the state, no one else. In such cases, declaring the outer class a friend of the inner class makes sense. Conclusion Today we discussed cases when a class declares itself as a friend. Well, not exactly, maybe. We saw template classes declaring other specializations as friends, and nested classes where inner classes declare their enclosing classes as friends. Have you ever had to use such a technique? Connect deeper If you liked this article, please hit on the like button, subscribe to my newsletter","headline":"Declaring a friendship to self","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sandordargo.com/blog/2025/05/14/friend-self"},"url":"https://www.sandordargo.com/blog/2025/05/14/friend-self"}</script><title>Declaring a friendship to self | Sandor Dargo's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-89625019-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-89625019-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/SANDOR_DARGO_ROUND.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sandor Dargo's Blog</a></div><div class="site-subtitle font-italic">On C++, software development and books</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/dailycpp/" class="nav-link"> <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>DAILY C++</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HI...</span> </a></ul><ul class="w-100"><li class="nav-item"> <a href="https://www.patreon.com/sandordargo" class="nav-link"> <img src="https://c5.patreon.com/external/logo/become_a_patron_button.png"></a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sandordargo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/SandorDargo" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sandor.dargo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Blog </a> </span> <span> <a href="/2025"> 2025 </a> </span> <span> <a href="/05"> 05 </a> </span> <span> <a href="/14"> 14 </a> </span> <span>Declaring a friendship to self</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Declaring a friendship to self</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sandor Dargo </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, May 14, 2025, 12:00 AM +0200" prep="on" > May 14, 2025 <i class="unloaded">2025-05-14T00:00:00+02:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="700 words">3 min</span></div></div><div class="post-content"><p>Recently, I ran into some code where a class declared itself as a friend. I was quite surprised to see that and at a second glance, I realised that there were 2 characters difference in a relatively long class name. But my curiosity was already awakened.</p><p>Are there situations when a class should include a friendship declaration to itself?</p><p>First of all, if you declare a class friend of itself directly, the compiler might issue a warning.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">C</span> <span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">C</span><span class="p">;</span> <span class="c1">// warning: class 'C' is implicitly friends with itself</span>
<span class="p">};</span>
</pre></table></code></div></div><p>Otherwise, I found two scenarios which I want to share with you. They are slightly different, you might consider cheating both, but these are the closest ones I found.</p><h2 id="explicitly-enabling-template-specialization-access">Explicitly Enabling Template Specialization Access</h2><p>The cheating in the first example is that it uses templates. You’ll see <code class="language-plaintext highlighter-rouge">friend class Wrapper</code> in <code class="language-plaintext highlighter-rouge">Wrapper</code>, but you’ll see more. In fact, <code class="language-plaintext highlighter-rouge">Wrapper</code> is <code class="language-plaintext highlighter-rouge">Wrapper&lt;T&gt;</code>. Instantiate <code class="language-plaintext highlighter-rouge">Wrapper</code> with different types, and they turn out to be distinct, unrelated types. What if you want to have access from a <code class="language-plaintext highlighter-rouge">Wrapper</code> specialization to private elements of <code class="language-plaintext highlighter-rouge">Wrapper&lt;U&gt;</code>.</p><p>Without declaring a friendship, it’s not going to work.</p><p>Let’s see the code.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;concepts&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">Wrapper</span> <span class="p">{</span>
<span class="nl">private:</span>
    <span class="kt">int</span> <span class="n">secret</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">U</span><span class="p">&gt;</span>
    <span class="k">friend</span> <span class="k">class</span> <span class="nc">Wrapper</span><span class="p">;</span> <span class="c1">// Friend itself to allow specializations access</span>

<span class="nl">public:</span>
    <span class="kt">void</span> <span class="n">showSecret</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Secret: "</span> <span class="o">&lt;&lt;</span> <span class="n">secret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="k">template</span> <span class="o">&lt;</span><span class="p">&gt;</span>
<span class="k">class</span> <span class="nc">Wrapper</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="nc">T</span><span class="p">&gt;</span> <span class="k">requires</span> <span class="p">(</span><span class="o">!</span><span class="n">std</span><span class="o">::</span><span class="n">same_as</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span><span class="p">)</span>
    <span class="kt">void</span> <span class="n">accessSecret</span><span class="p">(</span><span class="n">Wrapper</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&amp;</span> <span class="n">w</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Thanks to the friend declaration, this specialization can access private members</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Accessing: "</span> <span class="o">&lt;&lt;</span> <span class="n">w</span><span class="p">.</span><span class="n">secret</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">auto</span> <span class="n">w1</span> <span class="o">=</span> <span class="n">Wrapper</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="k">auto</span> <span class="n">w2</span> <span class="o">=</span> <span class="n">Wrapper</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="n">w1</span><span class="p">.</span><span class="n">accessSecret</span><span class="p">(</span><span class="n">w2</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Notice that the <code class="language-plaintext highlighter-rouge">Wrapper&lt;int&gt;</code> specialization defines an <code class="language-plaintext highlighter-rouge">accessSecret</code> method which accepts any instantiation of a <code class="language-plaintext highlighter-rouge">Wrapper</code> class and tries to access a private member of <code class="language-plaintext highlighter-rouge">Wrapper</code> called <code class="language-plaintext highlighter-rouge">secret</code>.</p><p>Remove the friendship and you’ll see that <code class="language-plaintext highlighter-rouge">Wrapper&lt;int&gt;</code> has no access to private elements of <code class="language-plaintext highlighter-rouge">Wrapper&lt;double&gt;</code>. Notice that we didn’t simply declare <code class="language-plaintext highlighter-rouge">Wrapper</code> as a friend, but we used a templated version <code class="language-plaintext highlighter-rouge">template &lt;typename U&gt; friend class Wrapper</code>.</p><p>You can play around with the code <a href="https://godbolt.org/z/or54b3xs4">on Godbolt</a>.</p><h2 id="declare-the-outer-class-as-a-friend">Declare the outer class as a friend</h2><p>Let’s talk about nested classes. An outer class doesn’t have access to the non-public members of an inner class, and an outer class has no access to the non-public members of an inner class.</p><p>Though it would be strange to speak about declaring the inner class as a friend in this article, there is no way to qualify to inner class as self. But to declare <code class="language-plaintext highlighter-rouge">Outer</code> as a friend of <code class="language-plaintext highlighter-rouge">Outer::Inner</code>, that’s not too strong a bending of my self-made constraints.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="k">class</span> <span class="nc">Outer</span> <span class="p">{</span>
   <span class="nl">public:</span>
    <span class="k">class</span> <span class="nc">Inner</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">secret</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

        <span class="k">friend</span> <span class="k">class</span> <span class="nc">Outer</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="kt">void</span> <span class="nf">revealSecret</span><span class="p">(</span><span class="k">const</span> <span class="n">Inner</span><span class="o">&amp;</span> <span class="n">inner</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Inner's secret is: "</span> <span class="o">&lt;&lt;</span> <span class="n">inner</span><span class="p">.</span><span class="n">secret</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">Outer</span><span class="o">::</span><span class="n">Inner</span> <span class="n">innerObj</span><span class="p">;</span>
    <span class="n">Outer</span> <span class="n">outerObj</span><span class="p">;</span>
    <span class="n">outerObj</span><span class="p">.</span><span class="n">revealSecret</span><span class="p">(</span><span class="n">innerObj</span><span class="p">);</span>  <span class="c1">// Prints: Inner's secret is: 42</span>
<span class="p">}</span>
</pre></table></code></div></div><p>I know this example is a bit simplistic. It’s also a bit difficult to imagine a real-life situation when an outer class needs access to non-public members of an inner class. But you can imagine situations where there is an inner class representing some sort of state and only the outer class should be able to manipulate the state, no one else.</p><p>In such cases, declaring the outer class a friend of the inner class makes sense.</p><h2 id="conclusion">Conclusion</h2><p>Today we discussed cases when a class declares itself as a friend. Well, not exactly, maybe. We saw template classes declaring other specializations as friends, and nested classes where inner classes declare their enclosing classes as friends.</p><p>Have you ever had to use such a technique?</p><h2 id="connect-deeper">Connect deeper</h2><p>If you liked this article, please</p><ul><li>hit on the like button,<li><a href="http://eepurl.com/gvcv1j">subscribe to my newsletter</a></ul><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a> <a href="/tags/friends/" class="post-tag no-text-decoration" >friends</a> <a href="/tags/templates/" class="post-tag no-text-decoration" >templates</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a><div class="share-wrapper"> <a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Declaring a friendship to self - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2025/05/14/friend-self" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Declaring a friendship to self - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2025/05/14/friend-self" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Declaring a friendship to self - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2025/05/14/friend-self" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=Declaring a friendship to self - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2025/05/14/friend-self" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2026/01/21/clocks-part-8-cpp20-timezones">Time in C++: C++20 Brought Us Time Zones</a><li><a href="/blog/2019/04/10/lesson-of-a-booking-dont-trust-the-system">Lesson of a booking: Don't trust the system!</a><li><a href="/blog/2020/07/22/always-catch-exceptions-by-reference">Why should we always catch exceptions by reference?</a><li><a href="/blog/2020/11/28/emergent-design">Emergent Design: The Evolutionary Nature of Professional Software Development by Scott Bain</a><li><a href="/blog/2021/10/06/airy-code-reviews">Bring some fresh AIR and write effective code review comments</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self-improvement</a> <a class="post-tag" href="/tags/management/">management</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2021/04/07/what-are-type-traits"><div class="card-body"> <span class="timeago small" > Apr 7, 2021 <i class="unloaded">2021-04-07T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>What are type traits?</h3><div class="text-muted small"><p> Let’s start with a more generic question, what is a trait? What does the word trait mean? According to the Cambridge Dictionary, a trait is “a particular characteristic that can produce a particu...</p></div></div></a></div><div class="card"> <a href="/blog/2021/06/02/different-ways-to-achieve-SFINAE"><div class="card-body"> <span class="timeago small" > Jun 2, 2021 <i class="unloaded">2021-06-02T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Different ways to achieve SFINAE</h3><div class="text-muted small"><p> Life is a chain of opportunities. Each task you take on will lead you to more doors hiding other opportunities. Some are worth opening, some are not. Proofreading C++20: Get the Details by Rainer...</p></div></div></a></div><div class="card"> <a href="/blog/2025/01/22/cpp26-pack-indexing"><div class="card-body"> <span class="timeago small" > Jan 22, 2025 <i class="unloaded">2025-01-22T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>C++26: pack indexing</h3><div class="text-muted small"><p> C++11 introduced parameter packs to provide a safer way to pass an undefined number of parameters to functions instead of relying on variadic functions. While packs are a useful feature, and since...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2025/05/07/cpp26-constexpr-exceptions" class="btn btn-outline-primary" prompt="Older"><p>C++26: constexpr exceptions</p></a> <a href="/blog/2025/05/21/cpp23-from-range-constructors" class="btn btn-outline-primary" prompt="Newer"><p>Constructing Containers from Ranges in C++23</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//sandordargo-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Declaring a friendship to self'; this.page.url = 'https://www.sandordargo.com/blog/2025/05/14/friend-self'; this.page.identifier = '/blog/2025/05/14/friend-self'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><div id="amzn-assoc-ad-be5a767b-3346-40aa-bc00-2eff0ce33d2b"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=be5a767b-3346-40aa-bc00-2eff0ce33d2b"></script> <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us16.list-manage.com","uuid":"b073dbd5c29322302f59a8cd8","lid":"d26240427e"}) })</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://twitter.com/SandorDargo">Sandor Dargo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self improvement</a> <a class="post-tag" href="/tags/management/">management</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sandordargo.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
