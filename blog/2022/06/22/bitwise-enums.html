<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Bitwise enumerations" /><meta property="og:locale" content="en_US" /><meta name="description" content="In C++ the size of a bool is 1 byte. That’s the case despite that it can only have two values, true or false which can be represented on one single bit. This might not be a concern all the time, but it’s for sure not optimal. There are different techniques in C++ to use that one byte better." /><meta property="og:description" content="In C++ the size of a bool is 1 byte. That’s the case despite that it can only have two values, true or false which can be represented on one single bit. This might not be a concern all the time, but it’s for sure not optimal. There are different techniques in C++ to use that one byte better." /><link rel="canonical" href="https://www.sandordargo.com/blog/2022/06/22/bitwise-enums" /><meta property="og:url" content="https://www.sandordargo.com/blog/2022/06/22/bitwise-enums" /><meta property="og:site_name" content="Sandor Dargo’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-22T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Bitwise enumerations" /><meta name="twitter:site" content="@SandorDargo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-06-29T18:08:26+02:00","datePublished":"2022-06-22T00:00:00+02:00","description":"In C++ the size of a bool is 1 byte. That’s the case despite that it can only have two values, true or false which can be represented on one single bit. This might not be a concern all the time, but it’s for sure not optimal. There are different techniques in C++ to use that one byte better.","headline":"Bitwise enumerations","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sandordargo.com/blog/2022/06/22/bitwise-enums"},"url":"https://www.sandordargo.com/blog/2022/06/22/bitwise-enums"}</script><title>Bitwise enumerations | Sandor Dargo's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-89625019-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-89625019-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/SANDOR_DARGO_ROUND.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sandor Dargo's Blog</a></div><div class="site-subtitle font-italic">On C++, software development and books</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/dailycpp/" class="nav-link"> <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>DAILY C++</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HI...</span> </a></ul><ul class="w-100"><li class="nav-item"> <a href="https://www.patreon.com/sandordargo" class="nav-link"> <img src="https://c5.patreon.com/external/logo/become_a_patron_button.png"></a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sandordargo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/SandorDargo" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sandor.dargo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Blog </a> </span> <span> <a href="/2022"> 2022 </a> </span> <span> <a href="/06"> 06 </a> </span> <span> <a href="/22"> 22 </a> </span> <span>Bitwise enumerations</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Bitwise enumerations</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sandor Dargo </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 22, 2022, 12:00 AM +0200" prep="on" > Jun 22, 2022 <i class="unloaded">2022-06-22T00:00:00+02:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 29, 2022, 6:08 PM +0200" prefix="Updated " > Jun 29, 2022 <i class="unloaded">2022-06-29T18:08:26+02:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1811 words">10 min</span></div></div><div class="post-content"><p>In C++ the size of a <code class="language-plaintext highlighter-rouge">bool</code> is 1 byte. That’s the case despite that it can only have two values, <code class="language-plaintext highlighter-rouge">true</code> or <code class="language-plaintext highlighter-rouge">false</code> which can be represented on one single bit. This might not be a concern all the time, but it’s for sure not optimal. There are different techniques in C++ to use that one byte better.</p><h2 id="the-idea-of-bitwise-enums">The idea of bitwise <code class="language-plaintext highlighter-rouge">enum</code>s</h2><p>The idea of bit flags is to use each bit in a clever, yet relatively readable way. When the flags are encapsulated with an <code class="language-plaintext highlighter-rouge">enum</code>, they are called bitwise <code class="language-plaintext highlighter-rouge">enum</code>s.</p><p>What is behind the idea?</p><p>On one byte, we can store 256 different values. One byte is not only the size of a <code class="language-plaintext highlighter-rouge">bool</code>, but it’s also the size of a <code class="language-plaintext highlighter-rouge">char</code>. The idea is to store 8 related boolean values on the 8 bits of a byte.</p><p>Technically, we could do this just by using a <code class="language-plaintext highlighter-rouge">char</code>.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="c1">// flag 1: is automatic</span>
<span class="c1">// flag 2: is electric</span>
<span class="c1">// flag 4: is 4x4</span>
<span class="c1">// flag 8: has rooftop</span>
<span class="c1">// flag 16: GPS</span>
<span class="kt">char</span> <span class="n">flags</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// 2 + 8 = 10</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
</pre></table></code></div></div><p>In this example, we see that we initialized our <code class="language-plaintext highlighter-rouge">flags</code> bitset with the combination of 2 and 8, so it represents an electric car with a rooftop. By using the <em>bitwise and operator</em> (<code class="language-plaintext highlighter-rouge">operator&amp;</code>) we could check what is turned on. Of course, there are lots of magic values here, let’s make it a bit better (pun intended).</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">constexpr</span> <span class="kt">char</span> <span class="n">isAutomaticFlag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="kt">char</span> <span class="n">isElectricFlag</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="kt">char</span> <span class="n">is4x4Flag</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="kt">char</span> <span class="n">hasRooftopFlag</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
<span class="k">constexpr</span> <span class="kt">char</span> <span class="n">hasGPSFlag</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">flags</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">isAutomaticFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">isElectricFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">is4x4Flag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">hasRooftopFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">hasGPSFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
</pre></table></code></div></div><p>Now we use each flag by its name instead of its value. The initialization is still problematic. We can either use an addition there or it would be more idiomatic with the checking part (<code class="language-plaintext highlighter-rouge">operator&amp;</code>) to use the <em>bitwise or operator</em> (<code class="language-plaintext highlighter-rouge">operator|</code>).</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="kt">char</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">isElectricFlag</span> <span class="o">|</span> <span class="n">hasRooftopFlag</span><span class="p">;</span>
</pre></table></code></div></div><p>The problem that we should still solve is that while all these values are related, we don’t communicate that well. Having meaningful names, pre- or postfixes are nice things, but it would be even better to encapsulate them. For encapsulating related values our best option is an <code class="language-plaintext highlighter-rouge">enum</code>!</p><h2 id="how-to-implement-the-scoped-bitwise-enum">How to implement the scoped bitwise <code class="language-plaintext highlighter-rouge">enum</code></h2><p>As this article’s first published in 2022, we should go with a <em>scoped <code class="language-plaintext highlighter-rouge">enum</code></em> (a.k.a <code class="language-plaintext highlighter-rouge">enum class</code>)!</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">enum</span> <span class="k">class</span> <span class="nc">CarOptions</span> <span class="o">:</span> <span class="kt">char</span> <span class="p">{</span>
    <span class="n">isAutomaticFlag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">isElectricFlag</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">is4x4Flag</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">hasRooftopFlag</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">hasGPSFlag</span> <span class="o">=</span> <span class="mi">16</span>
<span class="p">};</span>
</pre></table></code></div></div><p>But there is a problem! Our code breaks because of two reasons. First, our flags need to be prepended with their scopes and we also have to change the type of the <code class="language-plaintext highlighter-rouge">flags</code> variable to <code class="language-plaintext highlighter-rouge">CarOptions</code>. That’s easy peasy.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">CarOptions</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">isElectricFlag</span> <span class="o">|</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasRooftopFlag</span><span class="p">;</span>
</pre></table></code></div></div><p>The problem is that it does not compile because there is no match for <code class="language-plaintext highlighter-rouge">operator|</code>. To fix that we have to get the underlying values of each option, apply the bitwise operation to them and use the obtained value to construct another value.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">CarOptions</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">CarOptions</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">CarOptions</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">CarOptions</span><span class="o">::</span><span class="n">isElectricFlag</span><span class="p">)</span> <span class="o">|</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">CarOptions</span><span class="o">&gt;::</span><span class="n">type</span><span class="o">&gt;</span><span class="p">(</span><span class="n">CarOptions</span><span class="o">::</span><span class="n">hasRooftopFlag</span><span class="p">));</span>
</pre></table></code></div></div><p>That is long and ugly. Let’s break it into two statements.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="k">using</span> <span class="n">CarOptionsType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">CarOptions</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
<span class="n">CarOptions</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">CarOptions</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">CarOptions</span><span class="o">::</span><span class="n">isElectricFlag</span><span class="p">)</span> <span class="o">|</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">CarOptions</span><span class="o">::</span><span class="n">hasRooftopFlag</span><span class="p">));</span>
</pre></table></code></div></div><p>So first we get the underlying type of our enumeration. Though we could use simply <code class="language-plaintext highlighter-rouge">char</code> instead, this will always keep working, even if we change the underlying type of <code class="language-plaintext highlighter-rouge">CarOptions</code>. Then on the second line, we explicitly cast the flags we want to combine to their underlying types, we use <code class="language-plaintext highlighter-rouge">operator|</code> on them and then we initialize a new <code class="language-plaintext highlighter-rouge">CarOptions</code> with the obtained value. Just as before, but probably in a more readable way.</p><p>Lots of hassle and we are not done.</p><p>The checks with <code class="language-plaintext highlighter-rouge">operator&amp;</code> do not work either!</p><p>Following a similar logic, at the end, we’d end up with checks like this:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span><span class="p">)</span> <span class="o">&amp;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">CarOptions</span><span class="o">::</span><span class="n">isAutomaticFlag</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
</pre></table></code></div></div><p>This is definitely not acceptable. One option is to go with an unscoped <code class="language-plaintext highlighter-rouge">enum</code> where implicit conversions are allowed and we don’t have to change anything in our code, it’d just work.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="k">enum</span> <span class="n">CarOptions</span> <span class="o">:</span> <span class="kt">char</span> <span class="p">{</span>
    <span class="n">isAutomaticFlag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">isElectricFlag</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">is4x4Flag</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">hasRooftopFlag</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">hasGPSFlag</span> <span class="o">=</span> <span class="mi">16</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">isElectricFlag</span> <span class="o">|</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasRooftopFlag</span><span class="p">;</span>
    
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">isAutomaticFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">isElectricFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">is4x4Flag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasRooftopFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasGPSFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>Given the dangers of unscoped <code class="language-plaintext highlighter-rouge">enums</code> let’s think about another solution. What if we overloaded the necessary operators?</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="k">enum</span> <span class="k">class</span> <span class="nc">CarOptions</span> <span class="o">:</span> <span class="kt">char</span> <span class="p">{</span>
    <span class="n">isAutomaticFlag</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">isElectricFlag</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">is4x4Flag</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
    <span class="n">hasRooftopFlag</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">hasGPSFlag</span> <span class="o">=</span> <span class="mi">16</span>
<span class="p">};</span>

<span class="n">CarOptions</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="n">CarOptions</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">CarOptions</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">CarOptionsType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">CarOptions</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">CarOptions</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="o">|</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">CarOptions</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="n">CarOptions</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">CarOptions</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">CarOptionsType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">CarOptions</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">CarOptions</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="o">&amp;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// flag 32: mutually exclusive with 8, has skibox</span>
    <span class="n">CarOptions</span> <span class="n">flags</span> <span class="o">=</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">isElectricFlag</span> <span class="o">|</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasRooftopFlag</span><span class="p">;</span>
    
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">boolalpha</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">isAutomaticFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">isElectricFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">is4x4Flag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasRooftopFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasGPSFlag</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="sc">'\n'</span><span class="p">;</span>
    
<span class="p">}</span>
</pre></table></code></div></div><p>With a little bit of boilerplate, we managed to keep the original code. The only additional change is the scoping that is necessary due to the <code class="language-plaintext highlighter-rouge">enum</code> class.</p><p>It’s worth noting that you don’t necessarily want to use integer values in the enum. Since C++14, you might go with a binary format.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">enum</span> <span class="k">class</span> <span class="nc">CarOptions</span> <span class="o">:</span> <span class="kt">char</span> <span class="p">{</span>
    <span class="n">isAutomaticFlag</span> <span class="o">=</span> <span class="mb">0b1</span><span class="p">,</span>
    <span class="n">isElectricFlag</span> <span class="o">=</span> <span class="mb">0b10</span><span class="p">,</span>
    <span class="n">is4x4Flag</span> <span class="o">=</span> <span class="mb">0b100</span><span class="p">,</span>
    <span class="n">hasRooftopFlag</span> <span class="o">=</span> <span class="mb">0b100</span><span class="p">,</span>
    <span class="n">hasGPSFlag</span> <span class="o">=</span> <span class="mb">0b10000</span><span class="p">,</span>
<span class="p">};</span>
</pre></table></code></div></div><p>First I thought that maybe it’s more difficult to introduce a typo as such, but I realized that I was mistaken. Indeed, you only have to pay attention that in each value there is only one <code class="language-plaintext highlighter-rouge">1</code>, but you can accidentally use the same values for multiple constants as I just did with <code class="language-plaintext highlighter-rouge">is4x4Flag</code> and <code class="language-plaintext highlighter-rouge">hasRooftopFlag</code>. Even <code class="language-plaintext highlighter-rouge">-Wall -pedantic -Wextra</code> didn’t warn about that. So I’d argue that it’s still easier to keep it correct with decimal values.</p><h2 id="how-to-have-mutually-exclusive-flags">How to have mutually exclusive flags?</h2><p>So far we’ve seen how to handle many flags in one single byte. We can combine them and we can check what is turned on.</p><p>But what if we wanted to have mutually exclusive values. For example, it’s hard to imagine a car that can have both a manual and an automatic air conditioner at the same time.</p><p>Of course, one could say that let’s just not include it in the <code class="language-plaintext highlighter-rouge">CarOptions</code> and we could have a separate enum for that purpose and that would not be composed of bitflags. But let’s say we really want to extend our <code class="language-plaintext highlighter-rouge">CarOptions</code> with mutually exclusive options. What can we do?</p><p>We already overloaded <code class="language-plaintext highlighter-rouge">operator|</code>, let’s modify that.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="n">CarOptions</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="n">CarOptions</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">CarOptions</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">CarOptionsType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">CarOptions</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasManualACFlag</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasAutomaticACFlag</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">(</span><span class="s">"mutually exclusive values"</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nf">CarOptions</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="o">|</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The problem is that while this would throw an exception for <code class="language-plaintext highlighter-rouge">CarOptions mxFlags = CarOptions::hasManualACFlag | CarOptions::hasAutomaticACFlag;</code> it would pass for <code class="language-plaintext highlighter-rouge">CarOptions mxFlags2 = CarOptions::hasAutomaticACFlag | CarOptions::hasManualACFlag;</code>.</p><p>The brute force approach is to add one more condition with the reversed logic.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="n">CarOptions</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="n">CarOptions</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">CarOptions</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">using</span> <span class="n">CarOptionsType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">CarOptions</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasManualACFlag</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasAutomaticACFlag</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">(</span><span class="s">"mutually exclusive values"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasAutomaticACFlag</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span> <span class="o">&amp;</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasManualACFlag</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">(</span><span class="s">"mutually exclusive values"</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="nf">CarOptions</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="o">|</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>
</pre></table></code></div></div><p>While this works, it’s repetitive, error-prone and doesn’t scale. Imagine what would happen if we had 3 mutually exclusive fields. That would mean 6 different <code class="language-plaintext highlighter-rouge">if</code> statements to throw from!</p><p>We need a smarter solution!</p><p>For that, the best thing we can do is to rephrase what we want. We have a list of mutually exclusive flags. <code class="language-plaintext highlighter-rouge">opreator|</code> combines two options. We make sure that if they are different and both of them have mutually exclusive options, then we throw an exception. That’s something easier to grasp.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="n">CarOptions</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="n">CarOptions</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">CarOptions</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">lhs</span> <span class="o">==</span> <span class="n">rhs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">lhs</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">using</span> <span class="n">CarOptionsType</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">underlying_type</span><span class="o">&lt;</span><span class="n">CarOptions</span><span class="o">&gt;::</span><span class="n">type</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">array</span><span class="o">&lt;</span><span class="n">CarOptions</span><span class="p">,</span> <span class="mi">2</span><span class="o">&gt;</span> <span class="n">mxs</span> <span class="p">{</span><span class="n">CarOptions</span><span class="o">::</span><span class="n">hasAutomaticACFlag</span><span class="p">,</span> <span class="n">CarOptions</span><span class="o">::</span><span class="n">hasManualACFlag</span><span class="p">};</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">isLhsSetWithMxOption</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">any_of</span><span class="p">(</span><span class="n">mxs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">mxs</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="n">lhs</span><span class="p">](</span><span class="n">CarOptions</span> <span class="n">option</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span> <span class="o">&amp;</span> <span class="n">option</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">const</span> <span class="kt">bool</span> <span class="n">isRhsSetWithMxOption</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">any_of</span><span class="p">(</span><span class="n">mxs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">mxs</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="p">[</span><span class="n">rhs</span><span class="p">](</span><span class="n">CarOptions</span> <span class="n">option</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span> <span class="o">&amp;</span> <span class="n">option</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isLhsSetWithMxOption</span> <span class="o">&amp;&amp;</span> <span class="n">isRhsSetWithMxOption</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="n">std</span><span class="o">::</span><span class="n">invalid_argument</span><span class="p">(</span><span class="s">"mutually exclusive values"</span><span class="p">);</span>
    <span class="p">}</span>
        
    <span class="k">return</span> <span class="nf">CarOptions</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">lhs</span><span class="p">)</span> <span class="o">|</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">CarOptionsType</span><span class="o">&gt;</span><span class="p">(</span><span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>
</pre></table></code></div></div><p>So we start with a guard statement making sure that if the two options are the same, we don’t throw an exception. As a next step, we have the array of mutually exclusive options and then we check if both <code class="language-plaintext highlighter-rouge">lhs</code> and <code class="language-plaintext highlighter-rouge">rhs</code> have them turned on.</p><p>If we make the list of mutually exclusive fields an external dependency to <code class="language-plaintext highlighter-rouge">operator|</code>, we could even make it more dynamically configurable. But I let you implement it if you’re interested.</p><h2 id="conclusion">Conclusion</h2><p>Today we saw how to use bit flags and how to implement bit flag enumerations. We also saw that if we want to keep up with the winds of change and we want to go with scoped enums (a.k.a. <code class="language-plaintext highlighter-rouge">enum class</code>es) then we’d better overload <code class="language-plaintext highlighter-rouge">operator|</code> and <code class="language-plaintext highlighter-rouge">operator&amp;</code>. And that actually opens up more possibilities to go further and define mutually exclusive flags in the same <code class="language-plaintext highlighter-rouge">enum</code>.</p><p>Now it’s over to you! Do you sometimes use bit flag enums? If so, what are your preferences?</p><h2 id="connect-deeper">Connect deeper</h2><p>If you liked this article, please</p><ul><li>hit on the like button,<li><a href="http://eepurl.com/gvcv1j">subscribe to my newsletter</a><li>and let’s connect on <a href="https://twitter.com/SandorDargo">Twitter</a>!</ul><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a> <a href="/tags/enums/" class="post-tag no-text-decoration" >enums</a> <a href="/tags/bitflags/" class="post-tag no-text-decoration" >bitflags</a> <a href="/tags/bitwise/" class="post-tag no-text-decoration" >bitwise</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a><div class="share-wrapper"> <a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Bitwise enumerations - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2022/06/22/bitwise-enums" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Bitwise enumerations - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2022/06/22/bitwise-enums" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Bitwise enumerations - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2022/06/22/bitwise-enums" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=Bitwise enumerations - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2022/06/22/bitwise-enums" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2025/10/22/trip-report-budapest-cpp">Trip report: Budapest C++ - Breaking & Building C++</a><li><a href="/blog/2025/10/01/cpp26-optional-of-reference">C++26: std::optional&lt;T&amp;&gt;</a><li><a href="/blog/2025/09/24/trip-report-cppcon-2025">Trip report: CppCon 2025</a><li><a href="/blog/2025/07/23/format-your-own-type-part-1">Format your own type (Part 1)</a><li><a href="/blog/2025/07/02/cpponsea-trip-report">Trip report: C++ On Sea 2025</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self-improvement</a> <a class="post-tag" href="/tags/management/">management</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2023/02/15/evolution-of-enums"><div class="card-body"> <span class="timeago small" > Feb 15, 2023 <i class="unloaded">2023-02-15T00:00:00+01:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>The evolution of enums</h3><div class="text-muted small"><p> Constants are great. Types are great. Constants of a specific type are really great. This is why enum classes are just fantastic. Last year, we talked about why we should avoid using boolean funct...</p></div></div></a></div><div class="card"> <a href="/blog/2024/07/10/cpponsea2024-trip-report"><div class="card-body"> <span class="timeago small" > Jul 10, 2024 <i class="unloaded">2024-07-10T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Trip report: C++ On Sea 2024</h3><div class="text-muted small"><p> Last week, between the 3rd and 5th of July, I had the privilege to attend and present at C++ on Sea 2024 for the 5th time in a row! I’m grateful that the organizers accepted me not simply as a spe...</p></div></div></a></div><div class="card"> <a href="/blog/2024/07/24/5-reasons-not-to-talk-about-politics-at-work"><div class="card-body"> <span class="timeago small" > Jul 24, 2024 <i class="unloaded">2024-07-24T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>5 reasons why politics will ruin your career hopes</h3><div class="text-muted small"><p> I’m not apolitical, I do have my opinion and quite a strong one. Yet, I don’t let it interfere with my job. I don’t think that one should talk about his or her political agenda at work or that one ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2022/06/15/cpp23-narrowing-contextual-conversions-to-bool" class="btn btn-outline-primary" prompt="Older"><p>C++23: Narrowing contextual conversions to bool</p></a> <a href="/blog/2022/06/29/cpp-standardized" class="btn btn-outline-primary" prompt="Newer"><p>C++: standardized</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//sandordargo-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Bitwise enumerations'; this.page.url = 'https://www.sandordargo.com/blog/2022/06/22/bitwise-enums'; this.page.identifier = '/blog/2022/06/22/bitwise-enums'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><div id="amzn-assoc-ad-be5a767b-3346-40aa-bc00-2eff0ce33d2b"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=be5a767b-3346-40aa-bc00-2eff0ce33d2b"></script> <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us16.list-manage.com","uuid":"b073dbd5c29322302f59a8cd8","lid":"d26240427e"}) })</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://twitter.com/SandorDargo">Sandor Dargo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self improvement</a> <a class="post-tag" href="/tags/management/">management</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sandordargo.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
