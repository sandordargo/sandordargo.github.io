<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="pv-cache-enabled" content="false"><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Deliberate practice and memory management" /><meta property="og:locale" content="en_US" /><meta name="description" content="I have recently read the eye-opening book of Cal Newport, So Good They Can’t Ignore You. He emphasizes a lot on the importance of deliberate practice. I also decided to take a bit more seriously my practice sessions and I reorganized how I spend my personal pomodoros in the morning and at lunchtime to have more deliberate practice. I want to strech my limits. In C++, it’s not so difficult." /><meta property="og:description" content="I have recently read the eye-opening book of Cal Newport, So Good They Can’t Ignore You. He emphasizes a lot on the importance of deliberate practice. I also decided to take a bit more seriously my practice sessions and I reorganized how I spend my personal pomodoros in the morning and at lunchtime to have more deliberate practice. I want to strech my limits. In C++, it’s not so difficult." /><link rel="canonical" href="https://www.sandordargo.com/blog/2018/08/29/deliberate-practice-and-memory-management" /><meta property="og:url" content="https://www.sandordargo.com/blog/2018/08/29/deliberate-practice-and-memory-management" /><meta property="og:site_name" content="Sandor Dargo’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-08-29T00:00:00+02:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Deliberate practice and memory management" /><meta name="twitter:site" content="@SandorDargo" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-26T06:39:58+01:00","datePublished":"2018-08-29T00:00:00+02:00","description":"I have recently read the eye-opening book of Cal Newport, So Good They Can’t Ignore You. He emphasizes a lot on the importance of deliberate practice. I also decided to take a bit more seriously my practice sessions and I reorganized how I spend my personal pomodoros in the morning and at lunchtime to have more deliberate practice. I want to strech my limits. In C++, it’s not so difficult.","headline":"Deliberate practice and memory management","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.sandordargo.com/blog/2018/08/29/deliberate-practice-and-memory-management"},"url":"https://www.sandordargo.com/blog/2018/08/29/deliberate-practice-and-memory-management"}</script><title>Deliberate practice and memory management | Sandor Dargo's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=UA-89625019-1"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-89625019-1'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/SANDOR_DARGO_ROUND.JPG" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Sandor Dargo's Blog</a></div><div class="site-subtitle font-italic">On C++, software development and books</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/books/" class="nav-link"> <i class="fa-fw fas fa-book ml-xl-3 mr-xl-3 unloaded"></i> <span>BOOKS</span> </a><li class="nav-item"> <a href="/speaking/" class="nav-link"> <i class="fa-fw fas fa-microphone ml-xl-3 mr-xl-3 unloaded"></i> <span>SPEAKING</span> </a><li class="nav-item"> <a href="/dailycpp/" class="nav-link"> <i class="fa-fw fas fa-link ml-xl-3 mr-xl-3 unloaded"></i> <span>DAILY C++</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>HI...</span> </a></ul><ul class="w-100"><li class="nav-item"> <a href="https://www.patreon.com/sandordargo" class="nav-link"> <img src="https://c5.patreon.com/external/logo/become_a_patron_button.png"></a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/sandordargo" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/SandorDargo" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['sandor.dargo','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/blog"> Blog </a> </span> <span> <a href="/2018"> 2018 </a> </span> <span> <a href="/08"> 08 </a> </span> <span> <a href="/29"> 29 </a> </span> <span>Deliberate practice and memory management</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Deliberate practice and memory management</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Sandor Dargo </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Aug 29, 2018, 12:00 AM +0200" prep="on" > Aug 29, 2018 <i class="unloaded">2018-08-29T00:00:00+02:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Thu, Dec 26, 2024, 6:39 AM +0100" prefix="Updated " > Dec 26, 2024 <i class="unloaded">2024-12-26T06:39:58+01:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1135 words">6 min</span></div></div><div class="post-content"><p>I have recently read the eye-opening book of <a href="/blog/2018/08/22/so-good-they-cant-ignore-you">Cal Newport, So Good They Can’t Ignore You</a>. He emphasizes a lot on the importance of deliberate practice. I also decided to take a bit more seriously my practice sessions and I reorganized <a href="/blog/2018/02/28/setting-yourself-up-to-succeed">how I spend my personal pomodoros</a> in the morning and at lunchtime to have more deliberate practice. I want to strech my limits. In C++, it’s not so difficult.</p><p>In <a href="/blog/2018/08/08/gilded-rose-revisited">one of my articles</a>, I’ve already written about a new approach I used while implementing the <a href="https://github.com/emilybache/GildedRose-Refactoring-Kata">Gilded Rose kata</a>.</p><p>Now, I want to go into details regarding one part of the refactoring, the part I struggled the most with.</p><p>At that point, I’ve already created and implemented an <code class="language-plaintext highlighter-rouge">Updater</code> interface, to manage the <code class="language-plaintext highlighter-rouge">sellIn</code> and <code class="language-plaintext highlighter-rouge">quality</code> properties of an <code class="language-plaintext highlighter-rouge">Item</code>. But I didn’t like the solution, as it didn’t update directly the corresponding properties of the <code class="language-plaintext highlighter-rouge">Item</code>, instead just those of the <code class="language-plaintext highlighter-rouge">Updater</code>. Right after, it copied back the values of the <code class="language-plaintext highlighter-rouge">Updater</code> to the <code class="language-plaintext highlighter-rouge">Item</code> class.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Updater</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="n">Updater</span><span class="p">(</span><span class="kt">int</span> <span class="n">sellIn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quality</span><span class="p">)</span> <span class="o">:</span> <span class="n">_quality</span><span class="p">(</span><span class="n">quality</span><span class="p">),</span> <span class="n">_sellIn</span><span class="p">(</span><span class="n">sellIn</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Updater</span><span class="p">()</span> <span class="p">{};</span>

  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">updateQuality</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">updateSellIn</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// later these became protected</span>
  <span class="kt">int</span> <span class="n">_quality</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">_sellIn</span><span class="p">;</span>
 <span class="p">};</span>

<span class="c1">// There were several updaters implementing this abstract class</span>
<span class="c1">// ...</span>

<span class="p">};</span>

<span class="k">class</span> <span class="nc">Item</span> <span class="p">{</span>     
<span class="nl">public:</span>
    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">sellIn</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">quality</span><span class="p">;</span>
    <span class="n">Updater</span><span class="o">*</span> <span class="n">updater</span><span class="p">;</span>

    <span class="n">Item</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sellIn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quality</span><span class="p">)</span> <span class="o">:</span> <span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">sellIn</span><span class="p">(</span><span class="n">sellIn</span><span class="p">),</span> <span class="n">quality</span><span class="p">(</span><span class="n">quality</span><span class="p">)</span><span class="c1">//, updater()</span>
    <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="o">==</span> <span class="s">"Sulfuras, Hand of Ragnaros"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">updater</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SulfurasUpdater</span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">sellIn</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">quality</span><span class="p">);</span>
      <span class="p">}</span> 
      <span class="c1">// else if ...</span>

    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">updateSellIn</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">updater</span><span class="o">-&gt;</span><span class="n">updateSellIn</span><span class="p">();</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">sellIn</span> <span class="o">=</span> <span class="n">updater</span><span class="o">-&gt;</span><span class="n">sellIn</span><span class="p">;</span> <span class="c1">// This is so ugly!</span>
    <span class="p">}</span>

    <span class="kt">void</span> <span class="nf">updateQuality</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">updater</span><span class="o">-&gt;</span><span class="n">updateQuality</span><span class="p">();</span>
      <span class="k">this</span><span class="o">-&gt;</span><span class="n">quality</span> <span class="o">=</span> <span class="n">updater</span><span class="o">-&gt;</span><span class="n">quality</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>


</pre></table></code></div></div><p>What did I want to achieve instead and what were my constraints?</p><p>I wanted to update the attributes of the <code class="language-plaintext highlighter-rouge">Item</code> class from the <code class="language-plaintext highlighter-rouge">Updater</code>. My self-imposed constraint was that I didn’t want to change even the tiniest way how we have to interact with an Item in the tests. Not because I’m lazy, but the way we interact with our object in our tests is the same way our users would interact with the objects. If it changes for me in the tests, obviously it would change for our users. As such changes can be costly for our imagined clients, we might lose them when we introduce some API changes. Such changes are not welcome.</p><p>My idea was that in the constructor of the <code class="language-plaintext highlighter-rouge">Item</code> I’d pass the address of the <code class="language-plaintext highlighter-rouge">sellIn</code> and <code class="language-plaintext highlighter-rouge">quality</code> variables to the <code class="language-plaintext highlighter-rouge">Updater</code> instead of their values. Then in the <code class="language-plaintext highlighter-rouge">Updater</code>, instead of the values, I’d store references, i.e. non-null pointers.</p><p>Sounds good?</p><p>It definitely did sound better to me than the existing solution, until I implemented it.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">Updater</span> <span class="p">{</span>
 <span class="nl">public:</span>
  <span class="n">Updater</span><span class="p">(</span><span class="kt">int</span><span class="o">&amp;</span> <span class="n">sellIn</span><span class="p">,</span> <span class="kt">int</span><span class="o">&amp;</span> <span class="n">quality</span><span class="p">)</span> <span class="o">:</span> <span class="n">_quality</span><span class="p">(</span><span class="n">quality</span><span class="p">),</span> <span class="n">_sellIn</span><span class="p">(</span><span class="n">sellIn</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Updater</span><span class="p">()</span> <span class="p">{};</span>

  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">updateQuality</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">updateSellIn</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// later these became protected</span>
  <span class="kt">int</span><span class="o">&amp;</span> <span class="n">_quality</span><span class="p">;</span>
  <span class="kt">int</span><span class="o">&amp;</span> <span class="n">_sellIn</span><span class="p">;</span>
 <span class="p">};</span>

<span class="c1">//...</span>

<span class="k">class</span> <span class="nc">Item</span> <span class="p">{</span>
  <span class="c1">//...</span>

  <span class="kt">void</span> <span class="n">updateSellIn</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">updater</span><span class="o">-&gt;</span><span class="n">updateSellIn</span><span class="p">();</span>
    <span class="c1">// this-&gt;sellIn = updater-&gt;sellIn; // This line is removed now!</span>
  <span class="p">}</span>

  <span class="kt">void</span> <span class="nf">updateQuality</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">updater</span><span class="o">-&gt;</span><span class="n">updateQuality</span><span class="p">();</span>
    <span class="c1">// this-&gt;quality = updater-&gt;quality; // Just like this! Yay!</span>
  <span class="p">}</span>
<span class="p">};</span>

</pre></table></code></div></div><p>It didn’t work. The <code class="language-plaintext highlighter-rouge">quality</code> and <code class="language-plaintext highlighter-rouge">sellIn</code> attributes of the <code class="language-plaintext highlighter-rouge">Item</code> class were not updated. Okaaay… Well, not okay, not at all! I must have missed something, I thought. I read the code. It seemed fine. I read it again. And again. And again. Looking for that missing ampersand or something similarly trivial. I couldn’t find it.</p><p>It was quite late in the evening. I said I leave it like that for that night, I’d have a look into it later. Then I went to the bathroom, but I kept the laptop still turned on. Just in case the solution will hit me right in the head. And guess what, while I was standing there I realized that the problem must not be that <code class="language-plaintext highlighter-rouge">Item.quality</code> and <code class="language-plaintext highlighter-rouge">Item.sellIn</code> gets copied, but most probably the whole <code class="language-plaintext highlighter-rouge">Item</code> class gets copied somewhere and in the test I try to assert the properties of the original instance, while I update something else. I wanted to run back right then, but I had to wait a bit.</p><p>When I had a look at my test and I knew I got it.</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">//GildedRoseTextTests.cc</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="n">items</span><span class="p">;</span>
  <span class="n">items</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Item</span><span class="p">(</span><span class="s">"+5 Dexterity Vest"</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">));</span>
  <span class="n">items</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Item</span><span class="p">(</span><span class="s">"Aged Brie"</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
  <span class="c1">// ...</span>
  <span class="n">GildedRose</span> <span class="n">app</span><span class="p">(</span><span class="n">items</span><span class="p">);</span>
  <span class="c1">// ...</span>
  <span class="n">app</span><span class="p">.</span><span class="n">processItems</span><span class="p">();</span>
<span class="p">}</span>

</pre></table></code></div></div><p>I added some logs to make it sure and yes.</p><p>The address of an <code class="language-plaintext highlighter-rouge">Item</code> was different in the constructor and in when <code class="language-plaintext highlighter-rouge">updateQuality</code> or <code class="language-plaintext highlighter-rouge">updateSellIn</code> were called. I created an Item and when it was pushed back to items vector, it got copied. That’s fine. But it got copied in a bad way, including the member references.</p><p>If not implemented (or not explicitly deleted starting from C++ 11), C++ will automatically implement the copy constructor and the assignment operator for you. Is that a good thing? It doesn’t matter. What matters is that it will happen and sometimes that implementation will not work the way you would expect it. Like it happened in this case.</p><p>What happened, in fact, is that a new copy of Item was created, a copy of the <code class="language-plaintext highlighter-rouge">sellIn</code> and the <code class="language-plaintext highlighter-rouge">updater</code> was created (at new addresses), but the reference to <code class="language-plaintext highlighter-rouge">sellIn</code> in the <code class="language-plaintext highlighter-rouge">updater</code> still pointed to the “old” sellIn of the copied object. So in fact <code class="language-plaintext highlighter-rouge">sellIn</code> was updated, but not the one we wanted.</p><p>The fix was easy, I just had to implement the copy constructor and the assignment operator:</p><div class="language-cpp highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="n">Item</span><span class="o">&amp;</span> <span class="n">Item</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Item</span><span class="o">&amp;</span> <span class="n">i</span><span class="p">){</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">quality</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">quality</span><span class="p">;</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">sellIn</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">sellIn</span><span class="p">;</span>
  <span class="k">this</span><span class="o">-&gt;</span><span class="n">updater</span> <span class="o">=</span> <span class="n">i</span><span class="p">.</span><span class="n">updater</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>


<span class="n">Item</span><span class="o">::</span><span class="n">Item</span><span class="p">(</span><span class="n">string</span> <span class="n">name</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sellIn</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quality</span><span class="p">)</span> <span class="o">:</span> <span class="n">name</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">sellIn</span><span class="p">(</span><span class="n">sellIn</span><span class="p">),</span> <span class="n">quality</span><span class="p">(</span><span class="n">quality</span><span class="p">)</span><span class="c1">//, updater()</span>
<span class="p">{</span>
  <span class="n">updater</span> <span class="o">=</span> <span class="n">Updater</span><span class="o">::</span><span class="n">CreateUpdater</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">sellIn</span><span class="p">,</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">quality</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>I was more than happy to see the implementation I wanted to achieve finally working. After the copy, the <code class="language-plaintext highlighter-rouge">updater</code>’s reference also pointed to the new <code class="language-plaintext highlighter-rouge">sellIn</code>.</p><p>I also found two important takeaways:</p><ol><li>Never forget about the copy constructor and the assignment operator.<li>C++ is a language that gives you a great power over how things should happen. And as you might know it well, with a great power, great responsibility also comes. Never forget that either.</ol><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/dev/'>dev</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cpp/" class="post-tag no-text-decoration" >cpp</a> <a href="/tags/dojo/" class="post-tag no-text-decoration" >dojo</a> <a href="/tags/gilded-rose/" class="post-tag no-text-decoration" >gilded rose</a> <a href="/tags/branch-by-abstraction/" class="post-tag no-text-decoration" >branch by abstraction</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a><div class="share-wrapper"> <a href="https://www.patreon.com/sandordargo" style="float: left; padding-left: 0;"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="https://c5.patreon.com/external/logo/become_a_patron_button.png" style="float: left; padding-left: 0;"></a> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Deliberate practice and memory management - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2018/08/29/deliberate-practice-and-memory-management" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Deliberate practice and memory management - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2018/08/29/deliberate-practice-and-memory-management" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Deliberate practice and memory management - Sandor Dargo's Blog&url=https://www.sandordargo.com/blog/2018/08/29/deliberate-practice-and-memory-management" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://news.ycombinator.com/submitlink?t=Deliberate practice and memory management - Sandor Dargo's Blog&u=https://www.sandordargo.com/blog/2018/08/29/deliberate-practice-and-memory-management" data-toggle="tooltip" data-placement="top" title="HackerNews" target="_blank" rel="noopener" aria-label="HackerNews"> <i class="fa-fw fab fa-hacker-news"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/blog/2026/01/21/clocks-part-8-cpp20-timezones">Time in C++: C++20 Brought Us Time Zones</a><li><a href="/blog/2019/04/10/lesson-of-a-booking-dont-trust-the-system">Lesson of a booking: Don't trust the system!</a><li><a href="/blog/2020/07/22/always-catch-exceptions-by-reference">Why should we always catch exceptions by reference?</a><li><a href="/blog/2020/11/28/emergent-design">Emergent Design: The Evolutionary Nature of Professional Software Development by Scott Bain</a><li><a href="/blog/2021/10/06/airy-code-reviews">Bring some fresh AIR and write effective code review comments</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self-improvement</a> <a class="post-tag" href="/tags/management/">management</a></div></div></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/blog/2018/08/08/gilded-rose-revisited"><div class="card-body"> <span class="timeago small" > Aug 8, 2018 <i class="unloaded">2018-08-08T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Gilded Rose kata revisited</h3><div class="text-muted small"><p> If you are into coding dojos and solving katas, you might have already tried the Gilded Rose kata by Emily Bache. In this kata, you are given some existing code that handles the quality and the nu...</p></div></div></a></div><div class="card"> <a href="/blog/2017/06/07/tdd-as-if-you-meant-it"><div class="card-body"> <span class="timeago small" > Jun 7, 2017 <i class="unloaded">2017-06-07T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>TDD as if you meant it</h3><div class="text-muted small"><p> The kata we picked was TDD as if you meant it. The rules are the ones of TDD, plus some additionals. These rules - such as write the code first at the test class and don’t move it until… - are not ...</p></div></div></a></div><div class="card"> <a href="/blog/2024/07/10/cpponsea2024-trip-report"><div class="card-body"> <span class="timeago small" > Jul 10, 2024 <i class="unloaded">2024-07-10T00:00:00+02:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Trip report: C++ On Sea 2024</h3><div class="text-muted small"><p> Last week, between the 3rd and 5th of July, I had the privilege to attend and present at C++ on Sea 2024 for the 5th time in a row! I’m grateful that the organizers accepted me not simply as a spe...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/blog/2018/08/22/so-good-they-cant-ignore-you" class="btn btn-outline-primary" prompt="Older"><p>Cal Newport: So Good They Can't Ignore You</p></a> <a href="/blog/2018/09/05/it-s-not-your-job" class="btn btn-outline-primary" prompt="Newer"><p>It's not your job!</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="text-center text-muted small pb-5"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> const options = { scriptUrl: '//sandordargo-github-io.disqus.com/embed.js', disqusConfig: function() { this.page.title = 'Deliberate practice and memory management'; this.page.url = 'https://www.sandordargo.com/blog/2018/08/29/deliberate-practice-and-memory-management'; this.page.identifier = '/blog/2018/08/29/deliberate-practice-and-memory-management'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('.post-content img'); const observer = lozad(imgs); observer.observe(); </script><div id="amzn-assoc-ad-be5a767b-3346-40aa-bc00-2eff0ce33d2b"></div><script async src="//z-na.amazon-adsystem.com/widgets/onejs?MarketPlace=US&adInstanceId=be5a767b-3346-40aa-bc00-2eff0ce33d2b"></script> <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script> <script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">require(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us16.list-manage.com","uuid":"b073dbd5c29322302f59a8cd8","lid":"d26240427e"}) })</script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2026 <a href="https://twitter.com/SandorDargo">Sandor Dargo</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/cpp/">cpp</a> <a class="post-tag" href="/tags/books/">books</a> <a class="post-tag" href="/tags/watercooler/">watercooler</a> <a class="post-tag" href="/tags/career/">career</a> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/cpp23/">cpp23</a> <a class="post-tag" href="/tags/stl/">stl</a> <a class="post-tag" href="/tags/algorithms/">algorithms</a> <a class="post-tag" href="/tags/self-improvement/">self improvement</a> <a class="post-tag" href="/tags/management/">management</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://www.sandordargo.com{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
